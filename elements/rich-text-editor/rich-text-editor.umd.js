!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lrnwebcomponents/code-editor/code-editor.js"),require("lit-element/lit-element.js"),require("shadow-selection-polyfill/shadow.js"),require("@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-button.js"),require("@lrnwebcomponents/rich-text-editor/lib/singletons/rich-text-editor-selection.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icon-lite.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icons.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icon-button-lite.js"),require("@lrnwebcomponents/hax-iconset/lib/simple-hax-iconset.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-link.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-image.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-underline.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-symbol-picker.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-heading-picker.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-source-code.js"),require("@lrnwebcomponents/simple-toolbar/simple-toolbar.js"),require("@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-button.js"),require("@lrnwebcomponents/absolute-position-behavior/absolute-position-behavior.js"),require("@lrnwebcomponents/utils/utils.js")):"function"==typeof define&&define.amd?define(["exports","@lrnwebcomponents/code-editor/code-editor.js","lit-element/lit-element.js","shadow-selection-polyfill/shadow.js","@lrnwebcomponents/simple-toolbar/lib/simple-toolbar-button.js","@lrnwebcomponents/rich-text-editor/lib/singletons/rich-text-editor-selection.js","@lrnwebcomponents/simple-icon/lib/simple-icon-lite.js","@lrnwebcomponents/simple-icon/lib/simple-icons.js","@lrnwebcomponents/simple-icon/lib/simple-icon-button-lite.js","@lrnwebcomponents/hax-iconset/lib/simple-hax-iconset.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-link.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-image.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-underline.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-symbol-picker.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-heading-picker.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-source-code.js","@lrnwebcomponents/simple-toolbar/simple-toolbar.js","@lrnwebcomponents/rich-text-editor/lib/buttons/rich-text-editor-button.js","@lrnwebcomponents/absolute-position-behavior/absolute-position-behavior.js","@lrnwebcomponents/utils/utils.js"],t):t((e=e||self).RichTextEditor={},null,e.litElement_js,e.shadow,e.simpleToolbarButton_js,null,null,null,null,null,null,null,null,null,null,null,e.simpleToolbar_js,e.richTextEditorButton_js,null,e.utils_js)}(this,function(e,t,n,o,i,r,a,s,c,l,d,u,h,b,p,g,m,f,y,v){"use strict";function k(e,t,n,o,i,r,a){try{var s=e[r](a),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(o,i)}function w(e){return function(){var t=this,n=arguments;return new Promise(function(o,i){var r=e.apply(t,n);function a(e){k(r,o,i,a,s,"next",e)}function s(e){k(r,o,i,a,s,"throw",e)}a(void 0)})}}function _(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function x(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function C(e,t,n){return t&&x(e.prototype,t),n&&x(e,n),e}function E(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);t&&(o=o.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,o)}return n}function S(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?B(Object(n),!0).forEach(function(t){E(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):B(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function T(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&L(e,t)}function j(e){return(j=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function L(e,t){return(L=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function R(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function O(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,o,i,r=j(e);if(t){var a=j(this).constructor;n=Reflect.construct(r,arguments,a)}else n=r.apply(this,arguments);return o=this,!(i=n)||"object"!=typeof i&&"function"!=typeof i?R(o):i}}function N(e,t,n){return(N="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var o=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=j(e)););return e}(e,t);if(o){var i=Object.getOwnPropertyDescriptor(o,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function A(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function H(e){return function(e){if(Array.isArray(e))return M(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return M(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return M(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function M(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=new Array(t);n<t;n++)o[n]=e[n];return o}var q,P,U,D,I,G=[n.css(q||(q=A(["\n    :host {\n      --simple-toolbar-border-color: var(--rich-text-editor-border-color, #ddd);\n      --simple-toolbar-border-width: var(--rich-text-editor-border-width, 1px);\n      --simple-toolbar-button-bg: var(--rich-text-editor-bg, #ffffff);\n      --simple-fields-focus-color: var(--rich-text-editor-focus-color, blue);\n      --simple-fields-invalid-color: var(--rich-text-editor-error-color, #800);\n    }\n  "])))],z=[].concat(G,[n.css(P||(P=A(["\n    :host {\n      --simple-toolbar-border-color: var(--rich-text-editor-border-color, #ddd);\n      --simple-toolbar-border-width: var(--rich-text-editor-border-width, 1px);\n      --simple-toolbar-button-opacity: var(\n        --rich-text-editor-button-opacity,\n        1\n      );\n      --simple-toolbar-button-color: var(--rich-text-editor-button-color, #444);\n      --simple-toolbar-button-bg: var(--rich-text-editor-button-bg, #ffffff);\n      --simple-toolbar-button-border-color: var(\n        --rich-text-editor-button-border-color,\n        transparent\n      );\n      --simple-toolbar-button-toggled-opacity: var(\n        --rich-text-editor-button-toggled-opacity,\n        1\n      );\n      --simple-toolbar-button-toggled-color: var(\n        --rich-text-editor-button-toggled-color,\n        #222\n      );\n      --simple-toolbar-button-toggled-bg: var(\n        --rich-text-editor-button-toggled-bg,\n        #ddd\n      );\n      --simple-toolbar-button-toggled-border-color: var(\n        --rich-text-editor-button-toggled-border-color,\n        transparent\n      );\n      --simple-toolbar-button-hover-opacity: var(\n        --rich-text-editor-button-hover-opacity,\n        1\n      );\n      --simple-toolbar-button-hover-color: var(\n        --rich-text-editor-button-hover-color,\n        #000\n      );\n      --simple-toolbar-button-hover-bg: var(\n        --rich-text-editor-button-hover-bg,\n        #f0f0f0\n      );\n      --simple-toolbar-button-hover-border-color: var(\n        --rich-text-editor-button-hover-border-color,\n        unset\n      );\n      --simple-toolbar-button-disabled-opacity: var(\n        --rich-text-editor-button-disabled-opacity,\n        1\n      );\n      --simple-toolbar-button-disabled-color: var(\n        --rich-text-editor-button-disabled-color,\n        #666\n      );\n      --simple-toolbar-button-disabled-bg: var(\n        --rich-text-editor-button-disabled-bg,\n        transparent\n      );\n      --simple-toolbar-button-disabled-border-color: var(\n        --rich-text-editor-button-disabled-border-color,\n        transparent\n      );\n    }\n  "])))]),F=function(e){return function(t){T(o,i.SimpleToolbarButtonBehaviors(e));var n=O(o);function o(){var e;return _(this,o),(e=n.call(this)).__selection=window.RichTextEditorSelection.requestAvailability(),e.tagsList="",e}return C(o,[{key:"render",value:function(){return N(j(o.prototype),"render",this).call(this)}},{key:"isToggled",get:function(){var e=!(!this.range||!this.command)&&document.queryCommandState(this.command),t="underline"===this.command?!!this.rangeQuery("u"):e;return!(!this.toggles||!t)}},{key:"operationCommand",get:function(){return this.isToggled&&this.toggledCommand?this.toggledCommand:this.command}},{key:"operationCommandVal",get:function(){return this.isToggled&&this.toggledCommand?this.toggledCommandVal||"":this.commandVal}},{key:"tagsArray",get:function(){return(this.tagsList||"").replace(/\s*/g,"").toLowerCase().split(",")}},{key:"firstUpdated",value:function(e){N(j(o.prototype),"firstUpdated",this)&&N(j(o.prototype),"firstUpdated",this).call(this,e)}},{key:"updated",value:function(e){var t=this;N(j(o.prototype),"updated",this).call(this,e),e.forEach(function(e,n){"controls"===n&&t._editorChanged(t.controls,e),"range"===n&&t._rangeChanged(t.range,e),["shortcutKeys","tagsList","tagClickCallback"].includes(n)&&t.updateButtonRegistry()})}},{key:"disconnectedCallback",value:function(){N(j(o.prototype),"disconnectedCallback",this).call(this)}},{key:"commandCallback",value:function(e,t,n){}},{key:"highlight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.dispatchEvent(new CustomEvent("highlight",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"highlightNode",value:function(e){this.dispatchEvent(new CustomEvent("highlightnode",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"selectRange",value:function(e){this.dispatchEvent(new CustomEvent("selectrange",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"selectNode",value:function(e){this.dispatchEvent(new CustomEvent("selectnode",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"selectNodeContents",value:function(e){this.dispatchEvent(new CustomEvent("selectnodeccontents",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"tagClickCallback",value:function(e){}},{key:"wrapSelection",value:function(e){this.dispatchEvent(new CustomEvent("wrapselection",{bubbles:!0,composed:!0,cancelable:!0,detail:e}))}},{key:"startNode",value:function(){var e=this.range?this.range.startContainer:void 0,t=this.range?this.range.startOffset:void 0;return e?e.children?e.children[t-1]:e.childNodes?e.childNodes[t-1]:void 0:void 0}},{key:"rangeElement",value:function(){return this.rangeIsElement()?this.startNode():this.rangeParent()}},{key:"rangeIsElement",value:function(){var e=this.range?this.range.startContainer:void 0,t=this.range?this.range.startOffset:void 0,n=this.range?this.range.endContainer:void 0,o=this.range?this.range.endOffset:void 0;return e===n&&o-t==1}},{key:"rangeParent",value:function(){var e=this.range?this.range.commonAncestorContainer:void 0;return e?1==e.nodeType?e:e.parentElement:void 0}},{key:"rangeQuery",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.tagsList;e=e.toLowerCase().replace(/\s*/g,"");var t=this.rangeElement(),n=t&&t.tagName?t.tagName.toLowerCase():void 0,o=e.split(",");return t?n&&o.includes(n)?t:t.closest(e):void 0}},{key:"sendCommand",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.operationCommand,t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.operationCommandVal,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.range;this.dispatchEvent(new CustomEvent("command",{bubbles:!0,cancelable:!0,composed:!0,detail:{command:e,commandVal:t,range:n,button:this}}))}},{key:"setRange",value:function(){var e=this.rangeQuery();e&&this.selectNode(e)}},{key:"_handleClick",value:function(e){e.preventDefault(),this.sendCommand()}},{key:"_editorChanged",value:function(e,t){}},{key:"_getSelection",value:function(){return"formatBlock"===this.command?this.rangeQuery():this._getSelectedHtml()}},{key:"_getSelectedHtml",value:function(){if(this.range){var e,t=document.createElement("div"),n=this.range.cloneContents();return t.appendChild(n),e=t.innerHTML,t.remove(),e?e.trim():void 0}}},{key:"_getSelectedTag",value:function(){var e=this.rangeQuery();return!(!e||!e.tagName)&&e.tagName.toLowerCase()}},{key:"_getSelectionType",value:function(){return"formatBlock"===this.command?this._getSelectedTag():this._getSelectedHtml()}},{key:"_rangeChanged",value:function(e,t){}}],[{key:"tag",get:function(){return"rich-text-editor-button"}},{key:"styles",get:function(){return[].concat(H(N(j(o),"styles",this)),H(z))}},{key:"properties",get:function(){return S(S({},N(j(o),"properties",this)),{},{command:{type:String,reflect:!0,attribute:"command"},commandVal:{attribute:"command-val",type:Object},range:{type:Object},tagsList:{type:String},target:{type:Object},toggledCommand:{attribute:"toggled-command",type:String,reflect:!0},toggledCommandVal:{attribute:"toggled-command-val",type:Object},selectedNode:{type:Object},selectionAncestors:{type:Array},__selection:{type:Object}})}}]),o}()},K=function(e){T(o,F(n.LitElement));var t=O(o);function o(){return _(this,o),t.apply(this,arguments)}return o}();window.customElements.define(K.tag,K);var V,Q=function(e){return function(t){T(i,m.SimpleToolbarBehaviors(e));var o=O(i);function i(){var e;return _(this,i),(e=o.call(this)).config=e.defaultConfig,e.clickableElements={},e.breadcrumbsLabel="Select",e.breadcrumbsSelectAllLabel="All",e}return C(i,[{key:"hasBreadcrumbs",get:function(){return!1}},{key:"undoButton",get:function(){return{command:"undo",icon:"undo",label:"Undo",shortcutKeys:"ctrl+z",type:"rich-text-editor-button"}}},{key:"redoButton",get:function(){return{command:"redo",icon:"redo",label:"Redo",shortcutKeys:"ctrl+shift+z",type:"rich-text-editor-button"}}},{key:"historyButtonGroup",get:function(){return{type:"button-group",buttons:[this.undoButton,this.redoButton]}}},{key:"formatButton",get:function(){return{label:"Format",type:"rich-text-editor-heading-picker"}}},{key:"boldButton",get:function(){return{command:"bold",icon:"editor:format-bold",label:"Bold",shortcutKeys:"ctrl+b",toggles:!0,type:"rich-text-editor-button"}}},{key:"italicButton",get:function(){return{command:"italic",icon:"editor:format-italic",label:"Italics",shortcutKeys:"ctrl+i",toggles:!0,type:"rich-text-editor-button"}}},{key:"underlineButton",get:function(){return{type:"rich-text-editor-underline"}}},{key:"removeFormatButton",get:function(){return{command:"removeFormat",icon:"editor:format-clear",label:"Erase Format",type:"rich-text-editor-button"}}},{key:"basicInlineButtonGroup",get:function(){return{type:"button-group",buttons:[this.formatButton,this.boldButton,this.italicButton,this.removeFormatButton]}}},{key:"linkButton",get:function(){return{icon:"link",label:"Link",shortcutKeys:"ctrl+k",type:"rich-text-editor-link"}}},{key:"linkButtonGroup",get:function(){return{type:"button-group",buttons:[this.linkButton]}}},{key:"cutButton",get:function(){return{command:"cut",icon:"content-cut",label:"Cut",shortcutKeys:"ctrl+x",type:"rich-text-editor-button"}}},{key:"copyButton",get:function(){return{command:"copy",icon:"content-copy",label:"Copy",shortcutKeys:"ctrl+c",type:"rich-text-editor-button"}}},{key:"pasteButton",get:function(){return{command:"paste",icon:"content-paste",label:"Paste",shortcutKeys:"ctrl+v",type:"rich-text-editor-button"}}},{key:"clipboardButtonGroup",get:function(){return{type:"button-group",buttons:[this.cutButton,this.copyButton,this.pasteButton]}}},{key:"subscriptButton",get:function(){return{command:"subscript",icon:"mdextra:subscript",label:"Subscript",toggles:!0,type:"rich-text-editor-button"}}},{key:"superscriptButton",get:function(){return{command:"superscript",icon:"mdextra:superscript",label:"Superscript",toggles:!0,type:"rich-text-editor-button"}}},{key:"scriptButtonGroup",get:function(){return{type:"button-group",buttons:[this.subscriptButton,this.superscriptButton]}}},{key:"symbolButton",get:function(){return{symbolTypes:["symbols"],type:"rich-text-editor-symbol-picker"}}},{key:"emojiButton",get:function(){return{type:"rich-text-editor-emoji-picker"}}},{key:"imageButton",get:function(){return{type:"rich-text-editor-image"}}},{key:"insertButtonGroup",get:function(){return{type:"button-group",buttons:[this.imageButton,this.symbolButton]}}},{key:"orderedListButton",get:function(){return{command:"insertOrderedList",icon:"editor:format-list-numbered",label:"Ordered List",toggles:!0,type:"rich-text-editor-button"}}},{key:"unorderedListButton",get:function(){return{command:"insertUnorderedList",icon:"editor:format-list-bulleted",label:"Unordered List",toggles:!0,type:"rich-text-editor-button"}}},{key:"blockquoteButton",get:function(){return{command:"formatBlock",commandVal:"blockquote",label:"Blockquote",icon:"editor:format-quote",shortcutKeys:"ctrl+'",type:"rich-text-editor-button"}}},{key:"indentButton",get:function(){return{command:"indent",icon:"editor:format-indent-increase",label:"Increase Indent",shortcutKeys:"ctrl+]",type:"rich-text-editor-button"}}},{key:"outdentButton",get:function(){return{command:"outdent",icon:"editor:format-indent-decrease",label:"Decrease Indent",shortcutKeys:"ctrl+[",type:"rich-text-editor-button"}}},{key:"listIndentButtonGroup",get:function(){return{type:"button-group",buttons:[this.orderedListButton,this.unorderedListButton,this.blockquoteButton,this.indentButton,this.outdentButton]}}},{key:"saveButton",get:function(){return{command:"save",icon:"save",label:"Save",type:"rich-text-editor-button"}}},{key:"closeButton",get:function(){return{command:"cancel",icon:"close",label:"Cancel",type:"rich-text-editor-button"}}},{key:"saveCloseButtonGroup",get:function(){return{type:"button-group",buttons:[this.saveButton]}}},{key:"sourceButton",get:function(){return{type:"rich-text-editor-source-code"}}},{key:"sourceButtonGroup",get:function(){return{type:"button-group",buttons:[this.sourceButton]}}},{key:"defaultConfig",get:function(){return[this.historyButtonGroup,this.basicInlineButtonGroup,this.linkButtonGroup,this.clipboardButtonGroup,this.scriptButtonGroup,this.insertButtonGroup,this.listIndentButtonGroup]}},{key:"miniConfig",get:function(){return[{type:"button-group",buttons:[this.boldButton,this.italicButton,this.removeFormatButton]},this.linkButtonGroup,this.scriptButtonGroup,{type:"button-group",buttons:[this.orderedListButton,this.unorderedListButton]}]}},{key:"miniTemplate",get:function(){return n.html(U||(U=A([' <div id="container">',"</div> "])),N(j(i.prototype),"toolbarTemplate",this))}},{key:"toolbarTemplate",get:function(){return N(j(i.prototype),"toolbarTemplate",this)}},{key:"render",value:function(){return this.toolbarTemplate}},{key:"firstUpdated",value:function(e){N(j(i.prototype),"firstUpdated",this).call(this,e),this.__selection=window.RichTextEditorSelection.requestAvailability(),this.register(),this.hasBreadcrumbs&&this._addBreadcrumbs()}},{key:"updated",value:function(e){var t=this;N(j(i.prototype),"updated",this).call(this,e),e.forEach(function(e,n){"range"===n&&t._rangeChange(),"editor"===n&&t._editorChange(),["editor","show","range"].includes(n)&&(t.hidden=t.disconnected),["breadcrumbs","sticky"].includes(n)&&t.breadcrumbs&&(t.breadcrumbs.sticky=t.sticky)})}},{key:"connectedCallback",value:function(){N(j(i.prototype),"connectedCallback",this).call(this),this.register()}},{key:"disconnectedCallback",value:function(){N(j(i.prototype),"disconnectedCallback",this).call(this),this.register(!0)}},{key:"controls",get:function(){return this.editor?this.editor.getAttribute("id"):void 0}},{key:"disconnected",get:function(){return"always"!=this.show&&("selection"!=this.show?!this.editor:this.noSelection)}},{key:"noSelection",get:function(){return!this.range||this.range.collapsed}},{key:"cancel",value:function(){this.dispatchEvent(new CustomEvent("cancel",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}},{key:"close",value:function(){this.dispatchEvent(new CustomEvent("disableediting",{bubbles:!0,cancelable:!0,composed:!0,detail:this})),this.editor=void 0,document.body.append(this)}},{key:"highlight",value:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.dispatchEvent(new CustomEvent("highlight",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}},{key:"register",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.dispatchEvent(new CustomEvent("register",{bubbles:!0,cancelable:!0,composed:!0,detail:{remove:e,toolbar:this}}))}},{key:"setRange",value:function(e){this.dispatchEvent(new CustomEvent("setrange",{bubbles:!0,cancelable:!0,composed:!0,detail:{editor:this.editor,range:e}}))}},{key:"selectNode",value:function(e){this.dispatchEvent(new CustomEvent("selectnode",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}},{key:"selectNodeContents",value:function(e){this.dispatchEvent(new CustomEvent("selectnodecontents",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}},{key:"selectRange",value:function(e){this.dispatchEvent(new CustomEvent("selectrange",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}},{key:"newEditor",value:function(e){var t=document.createElement("rich-text-editor");e.parentNode.insertBefore(t,e),t.appendChild(e)}},{key:"pasteFromClipboard",value:function(){this.dispatchEvent(new CustomEvent("pastefromclipboard",{bubbles:!0,cancelable:!0,composed:!0,detail:this.editor}))}},{key:"clearToolbar",value:function(){N(j(i.prototype),"clearToolbar",this)&&N(j(i.prototype),"clearToolbar",this).call(this),this.clickableElements={}}},{key:"deregisterButton",value:function(e){var t=this;N(j(i.prototype),"deregisterButton",this)&&N(j(i.prototype),"deregisterButton",this).call(this,e),(e.tagsArray||[]).forEach(function(e){return delete t.clickableElements[e]})}},{key:"registerButton",value:function(e){var t=this;N(j(i.prototype),"registerButton",this)&&N(j(i.prototype),"registerButton",this).call(this,e),"paste"!==e.command||navigator.clipboard?(e.disabled=!this.editor,(e.tagsArray||[]).forEach(function(n){return t.clickableElements[n]=function(t){return e.tagClickCallback(t)}})):e.remove()}},{key:"_addBreadcrumbs",value:function(){var e=this;this.breadcrumbs||(this.breadcrumbs=document.createElement("rich-text-editor-breadcrumbs"),this.breadcrumbs.onselectnode=function(t){return e._selectNode(t.detail)},document.body.appendChild(this.breadcrumbs),this.breadcrumbs.addEventListener("breadcrumb-click",this._handleBreadcrumb.bind(this))),this.breadcrumbs.label=this.breadcrumbsLabel}},{key:"_handleBreadcrumb",value:function(e){this.editor&&this.range?e.detail.selectAll?this.selectNodeContents(this.editor):this.selectNode(e.detail):this._rangeChange()}},{key:"_handleButtonUpdate",value:function(e){N(j(i.prototype),"_handleButtonUpdate",this)&&N(j(i.prototype),"_handleButtonUpdate",this).call(this,e)}},{key:"_editorChange",value:function(){var e=this;this.breadcrumbs&&(this.breadcrumbs.controls=this.controls,this.editor&&this.editor.parentNode.insertBefore(this.breadcrumbs,this.editor.nextSibling)),this.buttons.forEach(function(t){"close"!==t.command&&(t.disabled=!e.editor)}),this.range=void 0}},{key:"_rangeChange",value:function(){var e=this;if(this.range&&this.range.commonAncestorContainer&&this.editor&&this.editor.contains(this.range.commonAncestorContainer)){var t=this.range.commonAncestorContainer,n=1==t.nodeType?t:t.parentNode,o=[];n!==this.editor&&function t(n){o.push(n),n.parentNode&&n.parentNode!==e.editor&&t(n.parentNode)}(n),o.push({nodeName:this.breadcrumbsSelectAllLabel,selectAll:!0}),this.selectedNode=o[0],this.selectionAncestors=o.reverse(),(this.buttons||[]).forEach(function(t){t.range=void 0,t.range=e.range,t.selectedNode=e.selectedNode,t.selectionAncestors=e.selectionAncestors}),this.breadcrumbs&&(this.breadcrumbs.selectionAncestors=this.selectionAncestors,this.breadcrumbs.hidden=this.disconnected)}}}],[{key:"tag",get:function(){return"rich-text-editor-toolbar"}},{key:"miniStyles",get:function(){return[n.css(D||(D=A(["\n          :host {\n            position: relative;\n            height: 0;\n            margin: 0 auto;\n            padding: 0;\n            border: none;\n            background-color: none;\n          }\n          #container {\n            display: flex;\n            position: absolute;\n            bottom: 0;\n            margin: 0 auto;\n            padding: 0;\n            border: var(--rich-text-editor-border-width, 1px) solid\n              var(--rich-text-editor-border-color, #ddd);\n            background-color: var(\n              --rich-text-editor-bg,\n              var(--rich-text-editor-bg, #ffffff)\n            );\n          }\n        "])))]}},{key:"baseStyles",get:function(){return[].concat(H(N(j(i),"baseStyles",this)),H(f.RichTextStyles),[n.css(I||(I=A(["\n          :host {\n            border: var(--rich-text-editor-border-width, 1px) solid\n              var(--rich-text-editor-border-color, #ddd);\n            background-color: var(--rich-text-editor-bg, #ffffff);\n          }\n        "])))])}},{key:"styles",get:function(){return[].concat(H(this.baseStyles),H(N(j(i),"stickyStyles",this)))}},{key:"properties",get:function(){return S(S({},N(j(i),"properties",this)),{},{breadcrumbsLabel:{name:"breadcrumbsLabel",type:String,attribute:"breadcrumbs-label"},breadcrumbsSelectAllLabel:{name:"breadcrumbsSelectAllLabel",type:String,attribute:"breadcrumbs-select-all-label"},editor:{name:"editor",type:Object,attribute:"editor"},id:{name:"id",type:String,attribute:"id",reflect:!0},savedSelection:{name:"savedSelection",type:Object},range:{name:"range",type:Object},registered:{type:Boolean},selectedNode:{type:Object},selectionAncestors:{type:Array},show:{type:String,attribute:"show",reflect:!0},clickableElements:{name:"clickableElements",type:Object},__pasteDisabled:{name:"__pasteDisabled",type:Boolean,attribute:"paste-disabled",reflect:!0},__promptOpen:{name:"__promptOpen",type:Boolean},__selection:{type:Object}})}}]),i}()},W=function(e){T(o,Q(n.LitElement));var t=O(o);function o(){return _(this,o),t.apply(this,arguments)}return o}();window.customElements.define(W.tag,W);var $,J,X,Y,Z=function(e){T(o,Q(n.LitElement));var t=O(o);function o(){var e;return _(this,o),(e=t.call(this)).sticky=!1,e.config=e.miniConfig,e}return C(o,[{key:"render",value:function(){return n.html(V||(V=A([" "," "])),N(j(o.prototype),"miniTemplate",this))}},{key:"updated",value:function(e){var t=this;N(j(o.prototype),"updated",this).call(this,e),e.forEach(function(e,n){"sticky"===n&&t.sticky&&(t.sticky=!1)})}}],[{key:"tag",get:function(){return"rich-text-editor-toolbar-mini"}},{key:"styles",get:function(){return[].concat(H(N(j(o),"baseStyles",this)),H(N(j(o),"miniStyles",this)))}}]),o}();window.customElements.define(Z.tag,Z);var ee=function(e){T(o,n.LitElement);var t=O(o);function o(){var e;return _(this,o),(e=t.call(this)).hidden=!0,e.sticky=!1,e.label="Select",e}return C(o,[{key:"_handleClick",value:function(e){this.dispatchEvent(new CustomEvent("breadcrumb-click",{bubbles:!0,cancelable:!0,composed:!0,detail:e}))}},{key:"render",value:function(){var e=this;return n.html($||($=A(["\n      ",":\n      ","\n    "])),this.label,this.selectionAncestors?(this.selectionAncestors||[]).map(function(t,o){return n.html(J||(J=A(['\n              <button\n                class="','"\n                controls="','"\n                @click="','"\n                tabindex="0"\n              >\n                ',"\n              </button>\n              ","\n            "])),t.selectAll?"":"selectnode",e.controls,function(n){return e._handleClick(t)},t.nodeName.toLowerCase(),o+1>=(e.selectionAncestors||[]).length?"":n.html(X||(X=A([' <span class="divider"> &gt; </span> ']))))}):"")}}],[{key:"tag",get:function(){return"rich-text-editor-breadcrumbs"}},{key:"properties",get:function(){return{controls:{type:String},hidden:{type:Boolean,attribute:"hidden",reflect:!0},label:{type:String},sticky:{type:Boolean,reflect:!0},selectionAncestors:{type:Array}}}},{key:"styles",get:function(){return[].concat(H(f.RichTextToolbarStyles),[n.css(Y||(Y=A(["\n        :host {\n          display: block;\n          background-color: var(--rich-text-editor-bg, #ffffff);\n          color: var(--rich-text-editor-button-color #444);\n          border: var(--rich-text-editor-border-width, 1px) solid var(--rich-text-editor-border-color, #ddd);\n          padding: 3px 10px;\n        }\n        :host([sticky]) {\n          position: sticky;\n          bottom: 0;\n        }\n        .selectednode {\n          background-color: var(--rich-text-editor-button-bg, #ffffff);\n        }\n        button {\n          display: inline-block;\n          text-align: center;\n          min-width: 25px;\n          margin: 0;\n          padding: 2px 5px;\n        }\n        .selectNode {\n          font-family: monospace;\n        }\n      "])))])}}]),o}();window.customElements.define(ee.tag,ee);var te,ne,oe=function(e){T(o,Q(n.LitElement));var t=O(o);function o(){return _(this,o),t.call(this)}return C(o,[{key:"render",value:function(){return N(j(o.prototype),"render",this).call(this)}},{key:"hasBreadcrumbs",get:function(){return!0}}],[{key:"tag",get:function(){return"rich-text-editor-toolbar-full"}},{key:"styles",get:function(){return[].concat(H(N(j(o),"baseStyles",this)),H(N(j(o),"stickyStyles",this)))}},{key:"properties",get:function(){return S({},N(j(o),"properties",this))}}]),o}();window.customElements.define(oe.tag,oe);var ie,re,ae=function(e){T(o,n.LitElement);var t=O(o);function o(){var e;_(this,o);var n=R(e=t.call(this));return e.hidden=!0,e.__toolbars=[],e.__clipboard=document.createElement("textarea"),e.__clipboard.setAttribute("aria-hidden",!0),e.__clipboard.style.position="absolute",e.__clipboard.style.left="-9999px",e.__clipboard.style.top="0px",e.__clipboard.style.width="0px",e.__clipboard.style.height="0px",e.id=e._generateUUID(),document.body.appendChild(e.__clipboard),window.addEventListener("register",e._handleRegistration.bind(n)),e}return C(o,[{key:"validCommands",get:function(){return["backColor","bold","copy","createLink","cut","decreaseFontSize","defaultParagraphSeparator","delete","fontName","fontSize","foreColor","formatBlock","forwardDelete","hiliteColor","increaseFontSize","indent","insertBrOnReturn","insertHorizontalRule","insertHTML","insertImage","insertLineBreak","insertOrderedList","insertUnorderedList","insertParagraph","insertText","italic","justifyCenter","justifyFull","justifyLeft","justifyRight","outdent","paste","redo","removeFormat","selectAll","strikethrough","styleWithCss","subscript","superscript","undo","unlink","useCSS"]}},{key:"render",value:function(){return n.html(te||(te=A(["<slot></slot>"])))}},{key:"updated",value:function(e){N(j(o.prototype),"updated",this).call(this,e),e.forEach(function(e,t){})}},{key:"disconnectedCallback",value:function(){N(j(o.prototype),"disconnectedCallback",this).call(this)}},{key:"cancelEdits",value:function(e){e.revert(),this.edit(e,!1)}},{key:"closeToolbar",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:e.editor;t&&this.disableEditing(t),e.editor=void 0,document.body.append(e)}},{key:"disableEditing",value:function(e){e&&(this.getRoot(e).onselectionchange=void 0,e.viewSource=!1,e.disableEditing(),e.makeSticky(!1))}},{key:"edit",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1];if(e){var n=e?this.getConnectedToolbar(e):void 0,o=t?n.editor:void 0;this.highlight(n,!1),n&&o!==e&&(o&&this.disableEditing(o),n.editor=e,this.enableEditing(e,n))}}},{key:"enableEditing",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:this.getConnectedToolbar(e);e&&(e.makeSticky(n.sticky),e.parentNode.insertBefore(n,e),e.enableEditing(),this.updateRange(e),this.getRoot(e).onselectionchange=function(o){n.__promptOpen||t.updateRange(e)})}},{key:"expandRangeTo",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=arguments.length>1?arguments[1]:void 0,n=t?this.getRangeNode(t):void 0,o=n&&n.tagName?n.tagName.toLowerCase():void 0;return e.toLowerCase().replace(/\s*/g,"").split(",").includes(o)?n:n.closest(e)?(t.selectNode(n.closest(e)),t):void 0}},{key:"getRangeNode",value:function(e){var t=e?e.commonAncestorContainer:void 0,n=e?e.startContainer:void 0,o=e?e.startOffset:void 0,i=e?e.endContainer:void 0,r=e?e.endOffset:void 0,a=n&&n.children?n.children[o-1]:void 0;return n===i&&r-o==1?a:t}},{key:"getRoot",value:function(e){return e&&e!==document?e.parentNode?this.getRoot(e.parentNode):e:document}},{key:"getConnectedToolbar",value:function(e){if(e.id||(e.id=this._generateUUID()),!e.__connectedToolbar){var t,n=e.toolbar?(this.__toolbars||[]).filter(function(t){return e.toolbar&&t.id===e.toolbar}):[];0===n.length&&(n=e.type?(this.__toolbars||[]).filter(function(t){return e.type&&t.type===e.type}):[]),0===n.length&&(n=this.__toolbars),n[0]?t=n[0]:0===n.length&&(t=document.createElement(e.type||"rich-text-editor-toolbar"),e.parentNode.insertBefore(t,e)),t.id=t.id||e.toolbar||this._generateUUID(),e.__connectedToolbar=t}return e.__connectedToolbar}},{key:"highlight",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;this.toolbar=e,(e?e.editor:void 0)&&(!1!==t?e.range&&(this.hidden=!1,e.range.insertNode(this),n&&this.append(n),e.range.setStartAfter(this),this.range=e.range):(this.updateRange(e.editor,e.range),this.hidden=!0,this.toolbar=void 0,this.range=void 0,document.body.appendChild(this)),this.dispatchEvent(new CustomEvent("change",{bubbles:!0,cancelable:!0,composed:!0,detail:t})))}},{key:"highlightNode",value:function(e,t){this.selectNode(e,t.range,t.editor),this.highlight(t)}},{key:"pasteFromClipboard",value:function(e){var t=this;setTimeout(w(regeneratorRuntime.mark(function n(){var o,i,r;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return o=window.getSelection(),i=e.range,n.next=4,navigator.clipboard.readText();case 4:r=n.sent,t.__clipboard.value=r,t.__clipboard.focus(),t.__clipboard.select(),document.execCommand("paste"),o.removeAllRanges(),o.addRange(i),t.pasteIntoEditor(e,t.__clipboard.value);case 12:case"end":return n.stop()}},n)})),2e3)}},{key:"pasteIntoEditor",value:function(e,t){if(e){var n=e.range,o=document.createElement("div");if(e=n.commonAncestorContainer.parentNode.closest("[editing=true]:not([disabled]),input:not([disabled]),textarea:not([disabled])")){for(o.innerHTML=e.sanitizeHTML(t),n&&n.extractContents&&n.extractContents(),n.insertNode(o);o.firstChild;)o.parentNode.insertBefore(o.firstChild,o);o.parentNode.removeChild(o)}}}},{key:"registerEditor",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o=e?this.getConnectedToolbar(e):void 0,i={click:function(n){return t._handleEditorClick(e,n)},focus:function(n){o.__promptOpen||e.disabled||t.edit(e)},getrange:function(n){o.__promptOpen||(t.toolbar=o,t.updateRange(e,e.range))},keydown:function(n){return t._handleShortcutKeys(e,n)},pastefromclipboard:function(e){return t.pasteFromClipboard(e.detail)},pastecontent:function(e){return t._handlePaste(e)}};return n?Object.keys(i).forEach(function(t){return e.removeEventListener(t,i[t])}):Object.keys(i).forEach(function(t){return e.addEventListener(t,i[t])}),(e.__connectedToolbar.show=!e.__connectedToolbar.editor)&&this.edit(e),e.__connectedToolbar}},{key:"registerToolbar",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]&&arguments[1],o={command:function(n){n.stopImmediatePropagation();var o=n.detail||{};t._handleCommand(e,o.command,o.commandVal,o.range),o.button&&o.button.commandCallback&&o.button.commandCallback(e.editor,e,t)},disableediting:function(e){return t.disableEditing((e.detail||{}).editor)},highlight:function(n){t.highlight(e,n.detail)},highlightnode:function(n){t.highlightNode(n.detail,e)},pastefromclipboard:function(e){e.stopImmediatePropagation(),t.pasteFromClipboard(e.detail)},"rich-text-editor-prompt-closed":function(t){e.__promptOpen=!1},"rich-text-editor-prompt-open":function(t){e.__promptOpen=!0},setrange:function(e){t.range=(e.detail||{}).range,t.updateRange((e.detail||{}).editor,t.range),t.selectRange(t.range,(e.detail||{}).editor)},selectnode:function(n){t.selectNode(n.detail,e.range,e.editor)},selectnodecontents:function(n){t.selectNodeContents(n.detail,e.range,e.editor)},selectrange:function(n){t.selectRange(n.detail,e.editor)},wrapselection:function(n){t.surroundRange(n.detail,e.range)}};n||e.registered?(e.registered=!1,Object.keys(o).forEach(function(t){return e.removeEventListener(t,o[t])})):(this.__toolbars.push(e),Object.keys(o).forEach(function(t){return e.addEventListener(t,o[t])}),e.registered=!0)}},{key:"selectNode",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:this.toolbar.editor;if(!t){var o=window.getSelection();t=document.createRange(),o.removeAllRanges(),o.addRange(t)}t&&(t.selectNode(e),n&&this.updateRange(n,t))}},{key:"selectNodeContents",value:function(e,t,n){if(e){if(!t){var o=window.getSelection();t=document.createRange(),o.removeAllRanges(),o.addRange(t)}t&&(t.selectNodeContents(e),n&&this.updateRange(n,t))}}},{key:"selectRange",value:function(e){var t=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],n=arguments.length>2?arguments[2]:void 0;if(e){if(t){var o=window.getSelection();o.removeAllRanges(),o.addRange(e)}else e.isCollapsed||e.collapse();n&&this.updateRange(n)}return e}},{key:"surroundRange",value:function(e,t){return t&&(t.surroundContents(e),editor&&this.updateRange(editor)),t}},{key:"updateRange",value:function(e,t){if(e){var n=this.getConnectedToolbar(e);this.toolbar=n,t||(t=e.range),e.range=t,n&&(n.selectedNode=e.selectedNode,n.selectionAncestors=e.selectionAncestors,n.range=t)}}},{key:"_generateUUID",value:function(){var e=Math.floor(65536*(1+Math.random())).toString(16).substring(1);return"rte-"+"ss-s-s-s-sss".replace(/s/g,e)}},{key:"_handleBlur",value:function(e,t){null===t.relatedTarget||"rich-text-editor"===!t.relatedTarget.startsWith?this.edit(e,!0):e&&this.highlight(e.toolbar)}},{key:"_handleCommand",value:function(e,t,n,o){var i=e.editor;this.validCommands.includes(t)?(n=i?i.sanitizeHTML(n):n,this.range=i.range,this.updateRange(i,o),this.selectRange(o,i),"paste"!=t?document.execCommand(t,!1,n):navigator.clipboard&&this.pasteFromClipboard(i),this.highlight(e,!1)):"cancel"===t?(i&&i.revert(),e.close(i)):"close"===t&&e.close(i)}},{key:"_handleEditorClick",value:function(e,t){if(e&&!e.disabled){var n=this.getConnectedToolbar(e),o=e.__focused;if(n&&n.editor===e||this.edit(e),e.focus(),o){var i=n?Object.keys(n.clickableElements||{}):[],r=t.target||t.srcElement||{tagName:""},a={detail:r},s=(r.tagName||"").toLowerCase();s&&i.includes(s)&&(console.log(r),t.preventDefault(),n.clickableElements[s](a))}}}},{key:"_handleRegistration",value:function(e){e.detail&&(e.detail.toolbar&&this.registerToolbar(e.detail.toolbar,e.detail.remove),e.detail.editor&&this.registerEditor(e.detail.editor,e.detail.remove))}},{key:"_handleShortcutKeys",value:function(e,t){var n=e?this.getConnectedToolbar(e):void 0;e.editing&&n._handleShortcutKeys(t)}}],[{key:"tag",get:function(){return"rich-text-editor-selection"}},{key:"properties",get:function(){return{editor:{type:Object},collapsed:{type:Boolean,reflect:!0,attribute:"collapsed"},hidden:{type:Boolean,reflect:!0,attribute:"hidden"},id:{type:String,reflect:!0,attribute:"id"},observer:{type:Object},range:{type:Object},toolbar:{type:Object},__toolbars:{type:Array}}}},{key:"styles",get:function(){return[n.css(ne||(ne=A(["\n        :host {\n  background-color: var(--rich-text-editor-selection-bg, rgb(146, 197, 255));\n          margin: 0;\n          padding: 0;\n          display: inline-block;\n        }\n        :host([hidden]) {\n          display: none;\n        }\n        :host([collapsed]):after {\n          content: '|';\n          color: var(--simple-toolbar-selection-bg);\n          background-color: transparent;\n        }\n        :host + *,\n        ::slotted(*) {\n  background-color: var(--rich-text-editor-selection-bg, rgb(146, 197, 255));\n        }\n      "])))]}}]),o}();window.customElements.define(ae.tag,ae),window.RichTextEditorSelection={},window.RichTextEditorSelection.instance=null,window.RichTextEditorSelection.requestAvailability=function(){return null==window.RichTextEditorSelection.instance&&(window.RichTextEditorSelection.instance=document.createElement(ae.tag),document.body.appendChild(window.RichTextEditorSelection.instance)),window.RichTextEditorSelection.instance};var se=function(e){return function(t){T(r,e);var i=O(r);function r(){var e;_(this,r),(e=i.call(this)).placeholder="Click to edit",e.toolbar="",e.type="rich-text-editor-toolbar",e.id="",e.range=void 0,e.disabled=!1,e.__focused=!1,e.__hovered=!1,e.editing=!1,e.__selection=window.RichTextEditorSelection.requestAvailability();var t=R(e);return e.setAttribute("tabindex",1),document.addEventListener(o.eventName,e._getRange.bind(t)),e}return C(r,[{key:"render",value:function(){var e=this;return n.html(ie||(ie=A([' <div\n        id="container"\n        @focus="','"\n        @blur="','"\n        @mouseover="','"\n        @mouseout="','"\n      >\n        <div id="wysiwyg" aria-placeholder="','">\n          <slot></slot>\n        </div>\n        <code-editor\n          id="source"\n          font-size="13"\n          ?hidden="','"\n          language="html"\n          @value-changed="','"\n          word-wrap\n        >\n        </code-editor>\n      </div>'])),function(t){return e.__focused=!0},function(t){return e.__focused=!1},function(t){return e.__hovered=!0},function(t){return e.__hovered=!1},this.placeholder,!(this.viewSource&&this.editing),this._handleSourceChange)}},{key:"observer",get:function(){return new MutationObserver(this._getRange)}},{key:"connectedCallback",value:function(){var e=this;N(j(r.prototype),"connectedCallback",this).call(this),setTimeout(function(){e.register()},500)}},{key:"disconnectedCallback",value:function(){N(j(r.prototype),"disconnectedCallback",this).call(this),this.register(!0)}},{key:"firstUpdated",value:function(){N(j(r.prototype),"firstUpdated",this)&&N(j(r.prototype),"firstUpdated",this).call(this),this.isEmpty()&&this.rawhtml?this.setHTML(this.rawhtml):(this.isEmpty()&&(this.innerHTML=""),this._editableChange())}},{key:"updated",value:function(e){var t=this;N(j(r.prototype),"updated",this).call(this,e),e.forEach(function(e,n){"editing"===n&&t._editableChange(),"disabled"===n&&(t.disableEditing(),t.setAttribute("tabindex",t.disabled?-1:0)),"range"===n&&t._rangeChange(),"rawhtml"===n&&t.rawhtml&&t.setHTML(t.rawhtml),"viewSource"===n&&t._handleViewSourceChange(),["viewSource","editing"].includes(n)&&(t.editing&&!t.viewSource?t.setAttribute("contenteditable",!0):t.removeAttribute("contentEditable"))}),this.innerHTML||(this.innerHTML="")}},{key:"disableEditing",value:function(){this.editing=!1,this.dispatchEvent(new CustomEvent("editing-disabled",{bubbles:!0,composed:!0,cancelable:!0,detail:(this.innerHTML||"").replace(/<!--[^(-->)]*-->/g,"").trim()}))}},{key:"enableEditing",value:function(){this.editing=!0,this.dispatchEvent(new CustomEvent("editing-enabled",{bubbles:!0,composed:!0,cancelable:!0,detail:(this.innerHTML||"").replace(/<!--[^(-->)]*-->/g,"").trim()}))}},{key:"focus",value:function(){this.disabled||(this.__focused=!0),this.dispatchEvent(new CustomEvent("focus",{bubbles:!0,composed:!0,cancelable:!0,detail:this.querySelector("*")}))}},{key:"getHTML",value:function(){return this.isEmpty()?"":(this.innerHTML||"").replace(/<!--[^(-->)]*-->/g,"").trim()}},{key:"isEmpty",value:function(){return!this.innerHTML||""==this.trimHTML(this)}},{key:"makeSticky",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.classList.remove("heightmax"):this.classList.add("heightmax")}},{key:"observeChanges",value:function(){!(arguments.length>0&&void 0!==arguments[0])||arguments[0]?this.observer.observe(this,{attributes:!1,childList:!0,subtree:!0,characterData:!1}):this.observer&&this.observer.disconnect}},{key:"paste",value:function(e){this._handlePaste(e)}},{key:"register",value:function(){var e=arguments.length>0&&void 0!==arguments[0]&&arguments[0];window.dispatchEvent(new CustomEvent("register",{bubbles:!0,cancelable:!0,composed:!0,detail:{remove:e,editor:this}}))}},{key:"revert",value:function(){this.innerHTML=this.__canceledEdits}},{key:"rootNode",value:function(){return this.__selection?this.__selection.getRoot(this):document}},{key:"sanitizeHTML",value:function(e){if(e){var t="<body(.*\n)*>(.*\n)*</body>";return e.match(t)&&e.match(t).length>0&&(e=e.match(t)[0].replace(/<\?body(.*\n)*\>/i)),e}}},{key:"setHTML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=this.sanitizeHTML(e).trim();this.innerHTML=t,this.setCancelHTML(t),this.isEmpty()&&(this.innerHTML=""),this._editableChange()}},{key:"setCancelHTML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:this.innerHTML;this.__canceledEdits=e||""}},{key:"trimHTML",value:function(e){var t=e?e.innerHTML:void 0;return this.trimString(t)}},{key:"trimString",value:function(e){return(e||"").replace(/<!--[^(-->)]*-->/g,"").replace(/[\s\t\r\n]/gim,"")}},{key:"updateRange",value:function(){this.dispatchEvent(new CustomEvent("getrange",{bubbles:!0,cancelable:!0,composed:!0,detail:this}))}},{key:"_editableChange",value:function(){var e=this,t=function(t){if(e.isEmpty()&&t.key){e.innerHTML=t.key.replace(">","&gt;").replace("<","&lt;").replace("&","&amp;");e._getRange();e.range.selectNodeContents(e),e.range.collapse()}};this.editing?(this.addEventListener("keypress",t),this.setCancelHTML()):this.removeEventListener("keypress",t)}},{key:"_getRange",value:function(){var e=function e(t){var n=t.parentNode;return n?e(n):t};try{this.range=e(this)?o.getRange(e(this)):void 0}catch(e){this.range=void 0}return this.updateRange&&this.updateRange(),this.range}},{key:"_handlePaste",value:function(e){e&&(e.clipboardData||e.originalEvent.clipboardData)?(e.originalEvent||e).clipboardData.getData("text/html"):window.clipboardData&&window.clipboardData.getData("Text"),this.dispatchEvent(new CustomEvent("pastefromclipboard",{bubbles:!0,cancelable:!0,composed:!0,detail:this})),e.preventDefault()}},{key:"_handleSourceChange",value:function(e){var t=this;if(!this.__needsUpdate){var n="".concat(this.innerHTML),o=e.detail.value?"".concat(e.detail.value):n,i=this._outdentHTML(o).replace(/\s+/gm,""),r=this._outdentHTML(n).replace(/\s+/gm,"");this.__needsUpdate=i.localeCompare(r);this.__needsUpdate&&setTimeout(function(){t.__needsUpdate=!1,t.innerHTML=e.detail.value}.bind(this),300)}}},{key:"_outdentHTML",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"",t=(e=this.sanitizeHTML(e).replace(/[\s]*$/,"").replace(/^[\n\r]*/,"").replace(/[\n\r]+/gm,"\n")).match(/^\s+/),n=!!t&&t[0],o=!!n&&new RegExp("\\n".concat(n),"gm");return e=e.replace(/^\s+/,""),e=o?e.replace(o,"\n "):e}},{key:"_handleViewSourceChange",value:function(e){var t=this.shadowRoot?this.shadowRoot.querySelector("#source"):void 0;t&&this.viewSource?(t.editorValue=this._outdentHTML(this.innerHTML),t.addEventListener("value-changed",this._handleSourceChange.bind(this))):t&&t.removeEventListener("value-changed",this._handleSourceChange.bind(this))}},{key:"_rangeChange",value:function(e){}}],[{key:"styles",get:function(){return[].concat(H(G),[n.css(re||(re=A(["\n          :host {\n            display: block;\n          }\n          :host([hidden]) {\n            display: none;\n          }\n          :host([disabled]) {\n            cursor: not-allowed;\n          }\n          :host(:empty) {\n            opacity: 0.7;\n          }\n          :host(:focus) {\n            outline: none;\n          }\n\n          :host(.heightmax[editing]) {\n            max-height: calc(100vh - 200px);\n            overflow-y: scroll;\n          }\n\n          #container,\n          #wysiwyg {\n            display: block;\n            width: 100%;\n          }\n          #source,\n          #wysiwyg {\n            margin: 0;\n            padding: 0;\n            min-height: var(--rich-text-editor-min-height, 20px);\n            cursor: pointer;\n            outline: none;\n            flex: 1 1 100%;\n            width: 100%;\n          }\n          :host(:empty) #wysiwyg::after {\n            display: block;\n            content: attr(aria-placeholder);\n          }\n\n          :host(:hover),\n          :host(:focus-within) {\n            opacity: 1;\n            outline: var(--rich-text-editor-border-width, 1px) solid\n              var(--rich-text-editor-focus-color, blue);\n          }\n          :host([disabled]),\n          :host([view-source]) {\n            outline: none !important;\n          }\n\n          #source:hover,\n          #source:focus-within {\n            outline: var(--rich-text-editor-border-width, 1px) solid\n              var(--rich-text-editor-focus-color, blue);\n          }\n          :host([editing][view-source]) #container {\n            display: flex;\n            align-items: stretch;\n            justify-content: space-between;\n            width: 100%;\n          }\n          :host([editing][view-source]) #source,\n          :host([editing][view-source]) #wysiwyg {\n            resize: horizontal;\n            overflow: auto;\n            flex: 1 1 auto;\n            width: 50%;\n          }\n          :host([editing][view-source]) #source {\n            min-width: 300px;\n          }\n          :host([editing][view-source]) #wysiwyg {\n            cursor: not-allowed;\n            margin-right: 10px;\n            width: calc(50% - 10px);\n          }\n        "])))])}},{key:"properties",get:function(){return S(S({},N(j(r),"properties",this)),{},{id:{name:"id",type:String,reflect:!0,attribute:"id"},editing:{name:"editing",type:Boolean,reflect:!0,attribute:"editing"},disabled:{name:"disabled",type:Boolean,attribute:"disabled",reflect:!0},disableHover:{name:"disableHover",type:Boolean,attribute:"disable-hover"},placeholder:{name:"placeholder",type:String,reflect:!0,attribute:"placeholder"},toolbar:{name:"toolbar",type:String,reflect:!0,attribute:"toolbar"},range:{name:"range",type:Object,attribute:"range"},rawhtml:{type:String,attribute:"rawhtml"},type:{name:"type",type:String,reflect:!0,attribute:"type"},updateRange:{type:Boolean},viewSource:{type:Boolean,attribute:"view-source",reflect:!0},__canceledEdits:{type:Object},__connectedToolbar:{type:Object},__codeEditorValue:{type:String},__needsUpdate:{type:Boolean},__focused:{type:Boolean},__hovered:{type:Boolean},__selection:{type:Object}})}},{key:"tag",get:function(){return"rich-text-editor"}}]),r}()},ce=function(e){T(o,se(n.LitElement));var t=O(o);function o(){return _(this,o),t.apply(this,arguments)}return o}();window.customElements.define(ce.tag,ce),e.RichTextEditor=ce,e.RichTextEditorBehaviors=se,Object.defineProperty(e,"__esModule",{value:!0})});
