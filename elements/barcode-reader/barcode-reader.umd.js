!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lit-element/lit-element.js"),require("@lrnwebcomponents/es-global-bridge/es-global-bridge.js")):"function"==typeof define&&define.amd?define(["exports","lit-element/lit-element.js","@lrnwebcomponents/es-global-bridge/es-global-bridge.js"],t):t((e=e||self).BarcodeReader={},e.litElement_js)}(this,function(e,t){"use strict";function n(e,t,n,o,r,i,a){try{var d=e[i](a),c=d.value}catch(e){return void n(e)}d.done?t(c):Promise.resolve(c).then(o,r)}function o(e){return function(){var t=this,o=arguments;return new Promise(function(r,i){var a=e.apply(t,o);function d(e){n(a,r,i,d,c,"next",e)}function c(e){n(a,r,i,d,c,"throw",e)}d(void 0)})}}function r(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function i(e){return(i=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],function(){})),!0}catch(e){return!1}}();return function(){var n,o,r,a=i(e);if(t){var c=i(this).constructor;n=Reflect.construct(a,arguments,c)}else n=a.apply(this,arguments);return o=this,!(r=n)||"object"!=typeof r&&"function"!=typeof r?d(o):r}}function s(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var u,l,h,f=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(p,t.LitElement);var n,i,f,v=c(p);function p(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,p),e=v.call(this),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("ZXing",decodeURIComponent("undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("barcode-reader.umd.js",document.baseURI).href)+"/../lib/zxing.js"),window.addEventListener("es-bridge-zxing-loaded",e._control.bind(d(e))),e}return n=p,i=[{key:"render",value:function(){return t.html(u||(u=s(['\n      <div id="hidden">\n        <div>\n          <video muted autoplay id="video" playsinline="true" width="','%" height="','%"></video>\n          <canvas\n            id="canvas"\n            style="display: none; float: bottom;"\n          ></canvas>\n        </div>\n      </div>\n      <div>\n        Result: <span><input type="text" .value="','" /> </span\n      ><button id="render">Initialize scanner</button>\n      </div>\n      <div id="hidden2">\n        <div class="select">\n          <label for="videoSource">Video source: </label>\n          <select id="videoSource"></select>\n        </div>\n        <button id="go">Scan</button>\n      </div>\n    '])),this.scale,this.scale,this.value)}},{key:"_control",value:function(){var e=this,t=this.shadowRoot.querySelector("#video"),n=this.shadowRoot.querySelector("#canvas"),r=n.getContext("2d"),i=this.shadowRoot.querySelector("select#videoSource"),a=(this.shadowRoot.getElementById("videoOption"),this.shadowRoot.getElementById("go")),d=640,c=480,s=240,u=320,l=!0,f=null,v=null;!function e(){window.ZXing?setTimeout(function(){console.log("loaded zxing instance"),f=new window.ZXing,v=f.Runtime.addFunction(k)},100):setTimeout(e,100)}();var p,m,y,g,w,b,R,_,E,k=function(){var t=o(regeneratorRuntime.mark(function t(n,o,r,i){var d;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:d=new Uint8Array(f.HEAPU8.buffer,n,o),console.log(String.fromCharCode.apply(null,d)),e.value=String.fromCharCode.apply(null,d),a.removeAttribute("disabled");case 4:case"end":return t.stop()}},t)}));return function(e,n,o,r){return t.apply(this,arguments)}}();function S(){if(null==f)return a.removeAttribute("disabled"),void alert("Barcode Reader is not ready!");var e=null,n=0,o=0;l?(e=r,n=d,o=c):(e=mobileCtx,n=s,o=u),e.drawImage(t,0,0,n,o);var i=document.createElement("canvas");i.width=h.videoWidth,i.height=h.videoHeight;var p=i.getContext("2d"),m=h.videoWidth,y=h.videoHeight;p.drawImage(t,0,0,m,y);var g=p.getImageData(0,0,m,y).data,w=f._resize(m,y);console.time("decode barcode");for(var b=0,R=0;b<g.length;b+=4,R++)f.HEAPU8[w+R]=g[b];var _=f._decode_any(v);console.timeEnd("decode barcode"),console.log(_),-2==_?setTimeout(S,30):-3==_?(console.error("error code: ",_),a.removeAttribute("disabled")):0===_&&a.removeAttribute("disabled")}l="pc"==(p=navigator.userAgent.toLowerCase(),m="ipad"==p.match(/ipad/i),y="iphone os"==p.match(/iphone os/i),g="midp"==p.match(/midp/i),w="rv:1.2.3.4"==p.match(/rv:1.2.3.4/i),b="ucweb"==p.match(/ucweb/i),R="android"==p.match(/android/i),_="windows ce"==p.match(/windows ce/i),E="windows mobile"==p.match(/windows mobile/i),m||y||g||w||b||R||_||E?"phone":"pc"),a.onclick=function(){console.log("click"),e.value="",n.style.display="none",a.setAttribute("disabled",""),S()};i=this.shadowRoot.querySelector("select#videoSource");function x(){a.removeAttribute("disabled"),window.stream&&window.stream.getTracks().forEach(function(e){e.stop()});var e={video:{deviceId:{exact:i.value}}};navigator.mediaDevices.getUserMedia(e).then(I).catch(j)}function I(e){window.stream=e,t.srcObject=e}function j(e){console.error("Error: ",e)}navigator.mediaDevices.enumerateDevices().then(function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],o=document.createElement("option");o.value=n.deviceId,"videoinput"===n.kind?(o.text=n.label||"camera "+(i.length+1),i.appendChild(o)):console.log("Found one other kind of source/device: ",n)}}).then(x).catch(j),i.onchange=x}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){"value"===n&&t.dispatchEvent(new CustomEvent("value-changed",{detail:t}))})}},{key:"firstUpdated",value:function(){this.start().then(function(e){}),this.__context=this.shadowRoot.querySelector("canvas").getContext("2d"),this.__video=this.shadowRoot.querySelector("video"),this.__videoInputSelector=this.shadowRoot.querySelector("#videoInput"),h=this.shadowRoot.getElementById("video"),this._renderVideo().then(function(e){})}},{key:"_onFrame",value:function(){var e=o(regeneratorRuntime.mark(function e(){return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.__video.videoWidth>0&&this._drawFrame(this.__video),this.__animationFrameId=requestAnimationFrame(this._onFrame.bind(this));case 2:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_drawFrame",value:function(e){this.__context.drawImage(e,0,0,this.width,this.height,0,0,this.width,this.height)}},{key:"start",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:this.shadowRoot.getElementById("render").addEventListener("click",function(){"Initialize scanner"===t.shadowRoot.getElementById("render").innerHTML&&t._control()});case 1:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()},{key:"_renderVideo",value:function(){var e=o(regeneratorRuntime.mark(function e(){var t,n,o;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t=this.shadowRoot.getElementById("hidden"),n=this.shadowRoot.getElementById("render"),o=this.shadowRoot.getElementById("hidden2"),t.style.display="none",this.shadowRoot.getElementById("render").addEventListener("click",function(){setTimeout(function(){"none"===t.style.display?(t.style.display="inline",n.innerHTML="Hide Scanner",o.style.display="inline"):(t.style.display="none",n.innerHTML="Show Scanner",o.style.display="none")},100)});case 5:case"end":return e.stop()}},e,this)}));return function(){return e.apply(this,arguments)}}()}],f=[{key:"styles",get:function(){return t.css(l||(l=s(["\n      :host {\n        display: block;\n        position: relative;\n      }\n      canvas {\n        display: none;\n      }\n      video\n      {\n        border-style: solid;\n        border-color: rgba(0, 0, 0, 0.5);\n        border-width: 5px;\n      }\n      #hidden {\n        display: none;\n      }\n      #hidden2 {\n        display: none;\n      }\n    "])))}},{key:"properties",get:function(){return{value:{type:String,reflect:!0},scale:{type:Number,reflect:!0}}}},{key:"tag",get:function(){return"barcode-reader"}}],i&&r(n.prototype,i),f&&r(n,f),p}();customElements.define(f.tag,f),e.BarcodeReader=f,Object.defineProperty(e,"__esModule",{value:!0})});
