!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("lit-element/lit-element.js"),require("@lrnwebcomponents/es-global-bridge/es-global-bridge.js")):"function"==typeof define&&define.amd?define(["exports","lit-element/lit-element.js","@lrnwebcomponents/es-global-bridge/es-global-bridge.js"],t):t((e="undefined"!=typeof globalThis?globalThis:e||self).BarcodeReader={},e.litElement_js)}(this,(function(e,t){"use strict";function n(e,t,n,o,i,r,a){try{var d=e[r](a),c=d.value}catch(e){return void n(e)}d.done?t(c):Promise.resolve(c).then(o,i)}function o(e){return function(){var t=this,o=arguments;return new Promise((function(i,r){var a=e.apply(t,o);function d(e){n(a,i,r,d,c,"next",e)}function c(e){n(a,i,r,d,c,"throw",e)}d(void 0)}))}}function i(e,t){for(var n=0;n<t.length;n++){var o=t[n];o.enumerable=o.enumerable||!1,o.configurable=!0,"value"in o&&(o.writable=!0),Object.defineProperty(e,o.key,o)}}function r(e){return(r=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function a(e,t){return(a=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function d(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function c(e,t){return!t||"object"!=typeof t&&"function"!=typeof t?d(e):t}function s(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,o=r(e);if(t){var i=r(this).constructor;n=Reflect.construct(o,arguments,i)}else n=o.apply(this,arguments);return c(this,n)}}function l(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}var u,h,f,v=function(e){!function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}(g,e);var n,r,c,v,p,m,y=s(g);function g(){var e;return function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,g),e=y.call(this),window.ESGlobalBridge.requestAvailability(),window.ESGlobalBridge.instance.load("ZXing",decodeURIComponent("undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("barcode-reader.umd.js",document.baseURI).href)+"/../lib/zxing.js"),window.addEventListener("es-bridge-zxing-loaded",e._control.bind(d(e))),e}return n=g,r=[{key:"render",value:function(){return t.html(u||(u=l(['\n      <div id="hidden">\n        <div>\n          <video\n            muted\n            autoplay\n            id="video"\n            playsinline="true"\n            width="','%"\n            height="','%"\n          ></video>\n          <canvas id="canvas" style="display: none; float: bottom;"></canvas>\n        </div>\n      </div>\n      <div>\n        Result: <span><input type="text" .value="','" /> </span\n        ><button id="render">Initialize scanner</button>\n      </div>\n      <div id="hidden2">\n        <div class="select">\n          <label for="videoSource">Video source: </label>\n          <select id="videoSource"></select>\n        </div>\n        <button id="go">Scan</button>\n      </div>\n    '])),this.scale,this.scale,this.value)}},{key:"_control",value:function(){var e=this,t=this.shadowRoot.querySelector("#video"),n=this.shadowRoot.querySelector("#canvas"),i=n.getContext("2d"),r=this.shadowRoot.querySelector("select#videoSource");this.shadowRoot.getElementById("videoOption");var a=this.shadowRoot.getElementById("go"),d=!0,c=null,s=null;!function e(){window.ZXing?setTimeout((function(){console.log("loaded zxing instance"),c=new window.ZXing,s=c.Runtime.addFunction(b)}),100):setTimeout(e,100)}();var l,u,h,v,p,m,y,g,w,b=function(){var t=o(regeneratorRuntime.mark((function t(n,o,i,r){var d;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:d=new Uint8Array(c.HEAPU8.buffer,n,o),console.log(String.fromCharCode.apply(null,d)),e.value=String.fromCharCode.apply(null,d),a.removeAttribute("disabled");case 4:case"end":return t.stop()}}),t)})));return function(e,n,o,i){return t.apply(this,arguments)}}();function R(){if(null==c)return a.removeAttribute("disabled"),void alert("Barcode Reader is not ready!");var e=null,n=0,o=0;d?(e=i,n=640,o=480):(e=mobileCtx,n=240,o=320),e.drawImage(t,0,0,n,o);var r=document.createElement("canvas");r.width=f.videoWidth,r.height=f.videoHeight;var l=r.getContext("2d"),u=f.videoWidth,h=f.videoHeight;l.drawImage(t,0,0,u,h);var v=l.getImageData(0,0,u,h).data,p=c._resize(u,h);console.time("decode barcode");for(var m=0,y=0;m<v.length;m+=4,y++)c.HEAPU8[p+y]=v[m];var g=c._decode_any(s);console.timeEnd("decode barcode"),console.log(g),-2==g?setTimeout(R,30):-3==g?(console.error("error code: ",g),a.removeAttribute("disabled")):0===g&&a.removeAttribute("disabled")}function _(){a.removeAttribute("disabled"),window.stream&&window.stream.getTracks().forEach((function(e){e.stop()}));var e={video:{deviceId:{exact:r.value}}};navigator.mediaDevices.getUserMedia(e).then(E).catch(k)}function E(e){window.stream=e,t.srcObject=e}function k(e){console.error("Error: ",e)}d="pc"==(l=navigator.userAgent.toLowerCase(),u="ipad"==l.match(/ipad/i),h="iphone os"==l.match(/iphone os/i),v="midp"==l.match(/midp/i),p="rv:1.2.3.4"==l.match(/rv:1.2.3.4/i),m="ucweb"==l.match(/ucweb/i),y="android"==l.match(/android/i),g="windows ce"==l.match(/windows ce/i),w="windows mobile"==l.match(/windows mobile/i),u||h||v||p||m||y||g||w?"phone":"pc"),a.onclick=function(){console.log("click"),e.value="",n.style.display="none",a.setAttribute("disabled",""),R()},r=this.shadowRoot.querySelector("select#videoSource"),navigator.mediaDevices.enumerateDevices().then((function(e){for(var t=e.length-1;t>=0;--t){var n=e[t],o=document.createElement("option");o.value=n.deviceId,"videoinput"===n.kind?(o.text=n.label||"camera "+(r.length+1),r.appendChild(o)):console.log("Found one other kind of source/device: ",n)}})).then(_).catch(k),r.onchange=_}},{key:"updated",value:function(e){var t=this;e.forEach((function(e,n){"value"===n&&t.dispatchEvent(new CustomEvent("value-changed",{detail:t}))}))}},{key:"firstUpdated",value:function(){this.start().then((function(e){})),this.__context=this.shadowRoot.querySelector("canvas").getContext("2d"),this.__video=this.shadowRoot.querySelector("video"),this.__videoInputSelector=this.shadowRoot.querySelector("#videoInput"),f=this.shadowRoot.getElementById("video"),this._renderVideo().then((function(e){}))}},{key:"_onFrame",value:(m=o(regeneratorRuntime.mark((function e(){return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.__video.videoWidth>0&&this._drawFrame(this.__video),this.__animationFrameId=requestAnimationFrame(this._onFrame.bind(this));case 2:case"end":return e.stop()}}),e,this)}))),function(){return m.apply(this,arguments)})},{key:"_drawFrame",value:function(e){this.__context.drawImage(e,0,0,this.width,this.height,0,0,this.width,this.height)}},{key:"start",value:(p=o(regeneratorRuntime.mark((function e(){var t=this;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:this.shadowRoot.getElementById("render").addEventListener("click",(function(){"Initialize scanner"===t.shadowRoot.getElementById("render").innerHTML&&t._control()}));case 1:case"end":return e.stop()}}),e,this)}))),function(){return p.apply(this,arguments)})},{key:"_renderVideo",value:(v=o(regeneratorRuntime.mark((function e(){var t,n,o;return regeneratorRuntime.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t=this.shadowRoot.getElementById("hidden"),n=this.shadowRoot.getElementById("render"),o=this.shadowRoot.getElementById("hidden2"),t.style.display="none",this.shadowRoot.getElementById("render").addEventListener("click",(function(){setTimeout((function(){"none"===t.style.display?(t.style.display="inline",n.innerHTML="Hide Scanner",o.style.display="inline"):(t.style.display="none",n.innerHTML="Show Scanner",o.style.display="none")}),100)}));case 5:case"end":return e.stop()}}),e,this)}))),function(){return v.apply(this,arguments)})}],c=[{key:"styles",get:function(){return t.css(h||(h=l(["\n      :host {\n        display: block;\n        position: relative;\n      }\n      canvas {\n        display: none;\n      }\n      video {\n        border-style: solid;\n        border-color: rgba(0, 0, 0, 0.5);\n        border-width: 5px;\n      }\n      #hidden {\n        display: none;\n      }\n      #hidden2 {\n        display: none;\n      }\n    "])))}},{key:"properties",get:function(){return{value:{type:String,reflect:!0},scale:{type:Number,reflect:!0}}}},{key:"tag",get:function(){return"barcode-reader"}}],r&&i(n.prototype,r),c&&i(n,c),g}(t.LitElement);customElements.define(v.tag,v),e.BarcodeReader=v,Object.defineProperty(e,"__esModule",{value:!0})}));
