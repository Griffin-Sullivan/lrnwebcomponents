!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?t(exports,require("@lrnwebcomponents/md-block/md-block.js"),require("@lrnwebcomponents/video-player/video-player.js"),require("@lrnwebcomponents/csv-render/csv-render.js"),require("lit-element/lit-element.js"),require("@lrnwebcomponents/simple-colors/simple-colors.js"),require("@lrnwebcomponents/i18n-manager/lib/I18NMixin.js"),require("@lrnwebcomponents/utils/utils.js"),require("@lrnwebcomponents/simple-fields/lib/simple-fields-field.js"),require("@lrnwebcomponents/simple-fields/lib/simple-fields-tag-list.js"),require("@lrnwebcomponents/a11y-collapse/a11y-collapse.js"),require("@lrnwebcomponents/a11y-collapse/lib/a11y-collapse-group.js"),require("@lrnwebcomponents/editable-table/lib/editable-table-display.js"),require("@lrnwebcomponents/a11y-tabs/a11y-tabs.js"),require("@lrnwebcomponents/a11y-tabs/lib/a11y-tab.js"),require("@lrnwebcomponents/grid-plate/grid-plate.js"),require("@lrnwebcomponents/iframe-loader/lib/loading-indicator.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icon-lite.js"),require("@lrnwebcomponents/simple-icon/lib/simple-icons.js"),require("@github/time-elements/dist/time-elements.js")):"function"==typeof define&&define.amd?define(["exports","@lrnwebcomponents/md-block/md-block.js","@lrnwebcomponents/video-player/video-player.js","@lrnwebcomponents/csv-render/csv-render.js","lit-element/lit-element.js","@lrnwebcomponents/simple-colors/simple-colors.js","@lrnwebcomponents/i18n-manager/lib/I18NMixin.js","@lrnwebcomponents/utils/utils.js","@lrnwebcomponents/simple-fields/lib/simple-fields-field.js","@lrnwebcomponents/simple-fields/lib/simple-fields-tag-list.js","@lrnwebcomponents/a11y-collapse/a11y-collapse.js","@lrnwebcomponents/a11y-collapse/lib/a11y-collapse-group.js","@lrnwebcomponents/editable-table/lib/editable-table-display.js","@lrnwebcomponents/a11y-tabs/a11y-tabs.js","@lrnwebcomponents/a11y-tabs/lib/a11y-tab.js","@lrnwebcomponents/grid-plate/grid-plate.js","@lrnwebcomponents/iframe-loader/lib/loading-indicator.js","@lrnwebcomponents/simple-icon/lib/simple-icon-lite.js","@lrnwebcomponents/simple-icon/lib/simple-icons.js","@github/time-elements/dist/time-elements.js"],t):t((e=e||self).GradeBook={},null,null,null,e.litElement_js,e.simpleColors_js,e.I18NMixin_js,e.utils_js)}(this,function(e,t,n,r,i,a,s,o){"use strict";function l(e,t,n,r,i,a,s){try{var o=e[a](s),l=o.value}catch(e){return void n(e)}o.done?t(l):Promise.resolve(l).then(r,i)}function c(e){return function(){var t=this,n=arguments;return new Promise(function(r,i){var a=e.apply(t,n);function s(e){l(a,r,i,s,o,"next",e)}function o(e){l(a,r,i,s,o,"throw",e)}s(void 0)})}}function u(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function d(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function p(e,t,n){return t&&d(e.prototype,t),n&&d(e,n),e}function h(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function f(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable})),n.push.apply(n,r)}return n}function g(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?f(Object(n),!0).forEach(function(t){h(e,t,n[t])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):f(Object(n)).forEach(function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))})}return e}function m(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&v(e,t)}function b(e){return(b=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)})(e)}function v(e,t){return(v=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e})(e,t)}function y(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}function w(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Date.prototype.toString.call(Reflect.construct(Date,[],function(){})),!0}catch(e){return!1}}();return function(){var n,r,i,a=b(e);if(t){var s=b(this).constructor;n=Reflect.construct(a,arguments,s)}else n=a.apply(this,arguments);return r=this,!(i=n)||"object"!=typeof i&&"function"!=typeof i?y(r):i}}function k(e,t,n){return(k="undefined"!=typeof Reflect&&Reflect.get?Reflect.get:function(e,t,n){var r=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=b(e)););return e}(e,t);if(r){var i=Object.getOwnPropertyDescriptor(r,t);return i.get?i.get.call(n):i.value}})(e,t,n||e)}function x(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function S(e){return function(e){if(Array.isArray(e))return j(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return j(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(e);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return j(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function j(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function A(){var e=x(["\n      :host {\n        display: block;\n      }\n      img {\n        max-width: 150px;\n        height: 150px;\n        border-radius: 50%;\n      }\n      grid-plate {\n        --grid-plate-col-transition: none;\n        --grid-plate-item-margin: 0px;\n        --grid-plate-item-padding: 4px;\n      }\n      simple-icon-lite {\n        --simple-icon-height: 150px;\n        --simple-icon-width: 150px;\n      }\n    "]);return A=function(){return e},e}function R(){var e=x(["<li>\n                  ",": ","\n                </li>"]);return R=function(){return e},e}function O(){var e=x(["<li>",": ","</li>"]);return O=function(){return e},e}function q(){var e=x(['<li>\n                  <a href="mailto:','"\n                    >',"</a\n                  >\n                </li>"]);return q=function(){return e},e}function D(){var e=x(["<li>",": ","</li>"]);return D=function(){return e},e}function _(){var e=x(["<li>",": ","</li>"]);return _=function(){return e},e}function P(){var e=x(['\n                <simple-icon-lite icon="account-circle"></simple-icon-lite>\n              ']);return P=function(){return e},e}function C(){var e=x(['\n                <img\n                  src="','"\n                  alt="'," ",'"\n                />\n              ']);return C=function(){return e},e}function I(){var e=x(['\n      <grid-plate layout="1-2">\n        <div slot="col-1" style="text-align:center;">\n          ','\n        </div>\n        <div slot="col-2">\n          <h2>',"</h2>\n          <ul>\n            ","\n            ","\n            ","\n            ","\n            ","\n          </ul>\n        </div>\n      </grid-plate>\n    "]);return I=function(){return e},e}var L=function(e){m(n,s.I18NMixin(i.LitElement));var t=w(n);function n(){var e;return u(this,n),(e=t.call(this)).student={},e.t={profileImageFor:"Profile image for",userID:"User ID",preferredName:"Preferred name",emailAddress:"Email this student",notes:"Notes",interests:"Interests"},e.registerLocalization({context:y(e),namespace:"grade-book"}),e}return p(n,[{key:"render",value:function(){return i.html(I(),this.student.photo?i.html(C(),this.student.photo,this.t.photoOf,this.student.prefName):i.html(P()),this.student.name,this.student.userId?i.html(_(),this.t.userID,this.student.userId):"",this.student.prefName?i.html(D(),this.t.preferredName,this.student.prefName):"",this.student.email?i.html(q(),this.student.email,this.t.emailAddress):"",this.student.notes?i.html(O(),this.t.notes,this.student.notes):"",this.student.interests?i.html(R(),this.t.interests,this.student.interests.join(",")):"")}}],[{key:"properties",get:function(){return{student:{type:Object}}}},{key:"styles",get:function(){return i.css(A())}},{key:"tag",get:function(){return"grade-book-student-block"}}]),n}();function N(){var e=x(['\n        :host {\n          display: block;\n        }\n        :host([letter="F"]) {\n          --letter-grade-default-letter-background-color: #ff4444;\n        }\n        :host([letter="D"]) {\n          --letter-grade-default-letter-background-color: #ff7744;\n        }\n        :host([letter="C"]),\n        :host([letter="C+"]) {\n          --letter-grade-default-letter-background-color: #ffff00;\n        }\n        :host([letter="B"]),\n        :host([letter="B-"]) {\n          --letter-grade-default-letter-background-color: #ffff66;\n        }\n        :host([letter="B+"]),\n        :host([letter="A-"]) {\n          --letter-grade-default-letter-background-color: #aaffaa;\n        }\n        :host([letter="A"]) {\n          --letter-grade-default-letter-background-color: #55ff55;\n        }\n        :host([show-scale]) .wrap {\n          height: var(--letter-grade-wrap-height, 64px);\n          width: var(--letter-grade-wrap-width, 64px);\n        }\n        .wrap {\n          height: var(--letter-grade-wrap-height, 40px);\n          width: var(--letter-grade-wrap-width, 40px);\n          padding: var(--letter-grade-wrap-padding, 16px);\n          border: var(--letter-grade-wrap-border, 4px solid black);\n          border-radius: 50%;\n          box-shadow: rgb(0 0 0 / 20%) 0px 5px 5px 0px;\n          text-align: center;\n          justify-content: center;\n          vertical-align: middle;\n          background-color: var(\n            --letter-grade-wrap-background-color,\n            var(--letter-grade-default-letter-background-color, transparent)\n          );\n        }\n        .letter {\n          font-weight: var(--letter-grade-letter-font-weight, bold);\n          font-size: var(--letter-grade-letter-font-size, 40px);\n          line-height: var(\n            --letter-grade-letter-line-height,\n            var(--letter-grade-letter-font-size, 40px)\n          );\n          letter-spacing: -2px;\n        }\n        .score,\n        .range {\n          font-weight: var(--letter-grade-range-font-weight, normal);\n          font-size: var(--letter-grade-range-font-size, 12px);\n        }\n      ']);return N=function(){return e},e}function E(){var e=x(['<div class="range">\n              ',"% -\n              ","%\n            </div>"]);return E=function(){return e},e}function T(){var e=x(['<div class="score">\n              (',"/"," ",")\n            </div>"]);return T=function(){return e},e}function U(){var e=x(['\n      <div class="wrap">\n        <div class="letter">',"</div>\n        ","\n        ","\n      </div>\n    "]);return U=function(){return e},e}customElements.define(L.tag,L);var z=function(e){m(n,i.LitElement);var t=w(n);function n(){var e;return u(this,n),(e=t.call(this)).pointsSystem="pts",e.score=null,e.total=null,e.gradeScale=[],e._letterIndex=null,e.letter="",e.showScale=!1,e}return p(n,[{key:"render",value:function(){return i.html(U(),this.letter,this.showScale&&null!==this._letterIndex?i.html(T(),this.score,this.total,this.pointsSystem):"",this.showScale&&null!==this._letterIndex?i.html(E(),this.gradeScale[this._letterIndex].lowRange,this.gradeScale[this._letterIndex].highRange):"")}},{key:"updated",value:function(e){var t=this;e.forEach(function(e,n){["total","score","gradeScale"].includes(n)&&t[n]&&t.gradeScale.length>0&&(clearTimeout(t.__debounce),t.__debounce=setTimeout(function(){t.letter=t.calculateLetterGrade()},0))})}},{key:"calculateLetterGrade",value:function(){var e=this.score/this.total*100;if(this.gradeScale[0]&&e>=this.gradeScale[0].highRange)return this._letterIndex=0,this.gradeScale[0].letter;for(var t in this.gradeScale){var n=this.gradeScale[t];if(e<=n.highRange&&e>=n.lowRange)return this._letterIndex=t,this.gradeScale[t].letter}return this._letterIndex=this.gradeScale.length-1,this.gradeScale[this.gradeScale.length-1].letter}}],[{key:"styles",get:function(){return[i.css(N())]}},{key:"properties",get:function(){return{score:{type:Number},total:{type:Number},pointsSystem:{type:String,attribute:"points-system"},gradeScale:{type:Array,attribute:"grade-scale"},letter:{type:String,reflect:!0},showScale:{type:Boolean,reflect:!0,attribute:"show-scale"}}}},{key:"tag",get:function(){return"letter-grade"}}]),n}();function G(){var e=x(['\n        :host {\n          display: block;\n        }\n        loading-indicator {\n          --loading-indicator-background-color: var(\n            --simple-colors-default-theme-accent-2,\n            grey\n          );\n          --loading-indicator-color: var(\n            --simple-colors-default-theme-accent-10,\n            black\n          );\n        }\n        grid-plate {\n          --grid-plate-col-transition: none;\n          --grid-plate-item-margin: 8px;\n          --grid-plate-item-padding: 8px;\n        }\n        a11y-tabs {\n          --a11y-tabs-border-color: var(\n            --simple-colors-default-theme-accent-10,\n            black\n          );\n        }\n        a11y-collapse {\n          --a11y-collapse-border-color: var(\n            --simple-colors-default-theme-accent-10,\n            black\n          );\n        }\n        a11y-collapse:not([expanded]):hover {\n          background-color: var(--simple-colors-default-theme-accent-1, grey);\n        }\n        a11y-collapse div[slot="heading"] {\n          font-size: 16px;\n          font-weight: normal;\n          cursor: pointer;\n          line-height: 34px;\n          display: flex;\n        }\n        a11y-collapse[expanded] div[slot="heading"] {\n          font-weight: bold;\n        }\n        simple-fields-tag-list.drag-focus {\n          background-color: #dddddd;\n        }\n        simple-colors[accent-color] {\n          display: inline-flex;\n          width: 24px;\n          height: 24px;\n          margin: 4px 6px 0px 0px;\n        }\n        simple-colors[accent-color] span {\n          display: inline-flex;\n          width: 24px;\n          height: 24px;\n          background-color: var(\n            --simple-colors-default-theme-accent-3,\n            #eeeeee\n          );\n        }\n        simple-fields-field[type="textarea"] {\n          --simple-fields-font-size: 20px;\n        }\n        simple-fields-field[type="number"] {\n          --simple-fields-font-size: 40px;\n          line-height: 40px;\n        }\n\n        .student-feedback-score-heading {\n          display: flex;\n          font-size: 28px;\n          font-weight: bold;\n          line-height: 28px;\n          padding: 8px;\n        }\n        .student-feedback-score-heading h3 {\n          margin: 0 0 0 8px;\n          padding: 0px;\n        }\n\n        #totalpts {\n          width: 84px;\n          margin: 0px 12px;\n        }\n        .mini-map {\n          max-height: 150px;\n          max-width: 150px;\n          overflow: auto;\n        }\n        .mini-map div[data-pixel-row] {\n          height: 5px;\n        }\n        .mini-map div[data-pixel-col] {\n          background-color: yellow;\n          float: left;\n          width: 5px;\n          height: 5px;\n        }\n        .mini-map div[data-active-assignment-student-pixel] {\n          background-color: blue;\n        }\n        .student-feedback-wrap {\n          display: flex;\n        }\n        .student-feedback-wrap .student-feedback-text {\n          width: 80%;\n          margin: 0;\n        }\n        .student-feedback-wrap .student-feedback-text div.heading {\n          padding: 20px;\n        }\n        .student-feedback-wrap .student-feedback-score {\n          font-size: 40px;\n          line-height: 68px;\n          padding: 34px 16px;\n          display: flex;\n          width: 50%;\n        }\n        simple-tag {\n          margin: 2px;\n        }\n        simple-tag:focus,\n        simple-tag:hover {\n          --simple-fields-fieldset-border-color: var(\n            --simple-colors-default-theme-accent-10,\n            #eeeeee\n          );\n        }\n        .active-submission {\n          max-height: 400px;\n          width: 60%;\n          overflow: auto;\n          margin: 0 auto;\n        }\n        .active-submission iframe {\n          height: 400px;\n          width: 60%;\n        }\n        .tag-group {\n          position: sticky;\n          top: 0;\n        }\n        .student-report-wrap {\n          display: flex;\n          justify-content: space-evenly;\n        }\n        .student-report-score {\n          margin-top: -20px;\n        }\n        editable-table-display::part(td),\n        editable-table-display::part(th) {\n          text-align: center;\n          vertical-align: top;\n          max-width: 250px;\n        }\n        editable-table-display::part(simple-fields-field) {\n          --simple-fields-font-size: 32px;\n          --simple-fields-text-align: center;\n          background-color: transparent;\n          max-width: 100px;\n          padding: 0 0 28px 0;\n          margin: 0;\n        }\n      ']);return G=function(){return e},e}function M(){var e=x(["<loading-indicator></loading-indicator>"]);return M=function(){return e},e}function V(){var e=x(['<simple-tag\n                                  draggable="true"\n                                  tabindex="0"\n                                  @keypress="','"\n                                  @dragstart="','"\n                                  accent-color="','"\n                                  value="','"\n                                  .data="','"\n                                ></simple-tag>']);return V=function(){return e},e}function B(){var e=x(['\n                      <a11y-collapse>\n                        <div slot="heading">\n                          <simple-colors accent-color="','"\n                            ><span></span></simple-colors\n                          >','\n                        </div>\n                        <div slot="content">\n                          ',"\n                        </div>\n                      </a11y-collapse>\n                    "]);return B=function(){return e},e}function F(){var e=x(['\n                        <a11y-collapse>\n                          <div slot="heading">','</div>\n                          <div slot="content">\n                            <simple-fields-field\n                              ?disabled="','"\n                              .value="','"\n                              @value-changed="','"\n                              type="text"\n                              label="','"\n                              required\n                            ></simple-fields-field>\n                            <csv-render\n                              data-source="','"\n                            ></csv-render>\n                          </div>\n                        </a11y-collapse>\n                      ']);return F=function(){return e},e}function W(){var e=x(["\n                <h4>Qualitative Rubric Tags</h4>\n                <a11y-collapse-group heading-button>\n                  ","\n                  ","\n                </a11y-collapse-group>\n              "]);return W=function(){return e},e}function Y(){var e=x(["<loading-indicator></loading-indicator>"]);return Y=function(){return e},e}function H(){var e=x(['\n                                                                <li>\n                                                                  <a\n                                                                    href="','"\n                                                                    target="_blank"\n                                                                    rel="noopener noreferrer"\n                                                                    >',"</a\n                                                                  >\n                                                                </li>\n                                                              "]);return H=function(){return e},e}function J(){var e=x(["\n                                                          <ul>\n                                                            ","\n                                                          </ul>\n                                                        "]);return J=function(){return e},e}function Q(){var e=x([" -\n                                                        ",""]);return Q=function(){return e},e}function $(){var e=x([" <li>\n                                                    <span>","</span\n                                                    >","\n                                                    ","\n                                                  </li>"]);return $=function(){return e},e}function K(){var e=x(["",""]);return K=function(){return e},e}function X(){var e=x(["\n                                          <h4>","</h4>\n                                          <ul>\n                                            ","\n                                          </ul>\n                                        "]);return X=function(){return e},e}function Z(){var e=x(['\n                                <a11y-collapse class="student-feedback-text">\n                                  <div slot="heading" class="heading">\n                                    ','\n                                  </div>\n                                  <div slot="content">\n                                    <div class="student-feedback-score-heading">\n                                      <div>\n                                        ',"\n                                        /\n                                        ","\n                                      </div>\n                                      <h3>Criteria details</h3>\n                                    </div>\n                                    <p>","</p>\n                                    <h3>Your feedback</h3>\n                                    <ul>\n                                      ","\n                                    </ul>\n                                    <h3>Additional Criteria feedback</h3>\n                                    <p>\n                                      ","\n                                    </p>\n                                  </div>\n                                </a11y-collapse>\n                              "]);return Z=function(){return e},e}function ee(){var e=x(['\n                      <h2>Student feedback report</h2>\n                      <div class="student-report-wrap">\n                        <a11y-collapse-group\n                          heading-button\n                          expanded\n                          style="width:80%;"\n                        >\n                          ','\n                          <a11y-collapse class="student-feedback-text">\n                            <div slot="heading" class="heading">\n                              ','\n                            </div>\n                            <div slot="content">\n                              <p>','</p>\n                              <h3>Your total Score</h3>\n                              <div class="score-display">\n                                '," /\n                                ",'\n                                pts\n                              </div>\n                            </div>\n                          </a11y-collapse>\n                        </a11y-collapse-group>\n                        <letter-grade\n                          class="student-report-score"\n                          show-scale\n                          total="','"\n                          score="','"\n                        ></letter-grade>\n                      </div>\n                    ']);return ee=function(){return e},e}function te(){var e=x(["<loading-indicator></loading-indicator>"]);return te=function(){return e},e}function ne(){var e=x(['\n                                    <td>\n                                      <simple-fields-tag-list\n                                        style="background-color:transparent;"\n                                        data-criteria="','"\n                                        label="','"\n                                      ></simple-fields-tag-list>\n                                    </td>\n                                  ']);return ne=function(){return e},e}function re(){var e=x([" <td>","</td> "]);return re=function(){return e},e}function ie(){var e=x(["\n                        <h4>","</h4>\n                        <p>",'</p>\n                        <editable-table-display\n                          accent-color="','"\n                          bordered\n                          column-header\n                          condensed\n                          disable-responsive\n                          scroll\n                          striped\n                        >\n                          <table>\n                            <tbody>\n                              <tr>\n                                ',"\n                                <td>"," %</td>\n                              </tr>\n                              <tr>\n                                ",'\n                                <td>\n                                  <simple-fields-field\n                                    type="number"\n                                    part="simple-fields-field"\n                                    min="0"\n                                    value="','"\n                                    max="','"\n                                    maxlength="10"\n                                    data-rubric-score\n                                    data-criteria="','"\n                                  ></simple-fields-field>\n                                </td>\n                              </tr>\n                            </tbody>\n                          </table>\n                        </editable-table-display>\n                        <h4>Additional ',' feedback</h4>\n                        <simple-fields-field\n                          type="textarea"\n                          data-rubric-written\n                          data-criteria="','"\n                        ></simple-fields-field>\n                      ']);return ie=function(){return e},e}function ae(){var e=x(["\n                    <h3>","</h3>\n                    ",'\n                    <div class="student-feedback-wrap">\n                      <div class="student-feedback-text">\n                        <h3 class="heading">Overall feedback</h3>\n                        <simple-fields-field\n                          type="textarea"\n                          data-criteria="overall"\n                          data-rubric-written\n                        ></simple-fields-field>\n                      </div>\n                      <div class="student-feedback-score">\n                        <simple-icon-button-lite\n                          icon="','"\n                          @click="','"\n                        ></simple-icon-button-lite>\n                        <simple-fields-field\n                          ?disabled="','"\n                          type="number"\n                          min="0"\n                          id="totalpts"\n                          maxlength="10"\n                          @value-changed="','"\n                        ></simple-fields-field>\n                        /\n                        ','\n                        pts\n                        <letter-grade\n                          style="margin:-8px 0 0 16px;"\n                          total="','"\n                          score="','"\n                        ></letter-grade>\n                      </div>\n                    </div>\n                  ']);return ae=function(){return e},e}function se(){var e=x(["\n                    <tr>\n                      <td>","</td>\n                      <td>","</td>\n                      <td>","</td>\n                    </tr>\n                  "]);return se=function(){return e},e}function oe(){var e=x(["<loading-indicator></loading-indicator>"]);return oe=function(){return e},e}function le(){var e=x(["",""]);return le=function(){return e},e}function ce(){var e=x(["\n                <h3>\n                  ",'\n                </h3>\n                <ul>\n                  <li>\n                    Due date:\n                    <local-time\n                      datetime="','"\n                      month="short"\n                      day="numeric"\n                      year="numeric"\n                      hour="numeric"\n                      minute="numeric"\n                      time-zone-name="short"\n                    >\n                    </local-time>\n                  </li>\n                  <li>\n                    Date submitted:\n                    ',"\n                    minutes ago\n                  </li>\n                </ul>\n                <div>\n                  ","\n                </div>\n              "]);return ce=function(){return e},e}function ue(){var e=x(["<loading-indicator></loading-indicator>"]);return ue=function(){return e},e}function de(){var e=x(['\n                              <div\n                                data-pixel-col\n                                ?data-active-assignment-student-pixel="','"\n                              ></div>\n                            ']);return de=function(){return e},e}function pe(){var e=x([" <div data-pixel-row>\n                          ","\n                        </div>"]);return pe=function(){return e},e}function he(){var e=x(['\n                    <h4>Active submission map</h4>\n                    <div class="mini-map">\n                      ',"\n                    </div>\n                  "]);return he=function(){return e},e}function fe(){var e=x(["<loading-indicator></loading-indicator>"]);return fe=function(){return e},e}function ge(){var e=x(['\n                    <grade-book-student-block\n                      .student="','"\n                    ></grade-book-student-block>\n                  ']);return ge=function(){return e},e}function me(){var e=x(['\n      <grid-plate layout="1-1-1">\n        <div slot="col-1">\n          <button\n            @click="','"\n            value="prev"\n            ?disabled="','"\n          >\n            Previous student\n          </button>\n          <button\n            @click="','"\n            value="next"\n            ?disabled="','"\n          >\n            Next student\n          </button>\n        </div>\n        <div slot="col-2">\n          <button\n            @click="','"\n            value="prev"\n            ?disabled="','"\n          >\n            Previous assignment\n          </button>\n          <button\n            @click="','"\n            value="next"\n            ?disabled="','"\n          >\n            Next Assignment\n          </button>\n        </div>\n        <loading-indicator\n          ?loading="','"\n          slot="col-3"\n        ></loading-indicator>\n      </grid-plate>\n      <a11y-tabs full-width>\n        <a11y-tab icon="social:person" label="Active student">\n          <grid-plate layout="1-1">\n            <div slot="col-1">\n              ','\n            </div>\n            <div slot="col-2">\n              ','\n            </div>\n          </grid-plate>\n        </a11y-tab>\n        <a11y-tab icon="assignment-ind" label="Active Assessment">\n          ','\n        </a11y-tab>\n        <a11y-tab icon="list" label="Past submissions">\n          <p>This could be used to show past assignments</p>\n        </a11y-tab>\n        <a11y-tab icon="list" label="Grade scale">\n          <editable-table-display\n            accent-color="','"\n            bordered\n            column-header\n            condensed\n            disable-responsive\n            scroll\n            striped\n          >\n            <table>\n              <tbody>\n                <tr>\n                  <td>',"</td>\n                  <td>","</td>\n                  <td>","</td>\n                </tr>\n                ",'\n              </tbody>\n            </table>\n          </editable-table-display>\n        </a11y-tab>\n      </a11y-tabs>\n      <grid-plate layout="3-1">\n        <div slot="col-1">\n          <a11y-tabs\n            full-width\n            @a11y-tabs-active-changed="','"\n          >\n            <a11y-tab\n              icon="image:style"\n              label="Assessment view"\n              id="assessmentview"\n            >\n              ','\n            </a11y-tab>\n            <a11y-tab icon="assignment" label="Student report">\n              <div>\n                ','\n              </div>\n            </a11y-tab>\n          </a11y-tabs>\n        </div>\n        <div slot="col-2" class="tag-group">\n          ',"\n        </div>\n      </grid-plate>\n    "]);return me=function(){return e},e}function be(){var e=x(["",'\n        <div class="active-submission">\n          <md-block .markdown="','"></md-block>\n        </div>']);return be=function(){return e},e}function ve(){var e=x(["",'\n          <div class="active-submission">\n            <iframe\n              src="','"\n              loading="lazy"\n              width="100%"\n              height="100%"\n            ></iframe>\n          </div>']);return ve=function(){return e},e}function ye(){var e=x(["",'<video-player\n            class="active-submission"\n            source="','"\n            width="60%"\n          ></video-player>']);return ye=function(){return e},e}function we(){var e=x(["",'<a\n          href="','"\n          target="_blank"\n          rel="noopener noreferrer"\n          ><simple-icon-button-lite\n            label="','"\n            icon="open-in-new"\n          ></simple-icon-button-lite\n        ></a>']);return we=function(){return e},e}function ke(){var e=x(["<h3>","</h3>"]);return ke=function(){return e},e}customElements.define(z.tag,z);var xe=function(e){m(n,s.I18NMixin(a.SimpleColors));var t=w(n);function n(){var e;return u(this,n),(e=t.call(this)).sheetGids={tags:0,roster:118800528,assignments:540222065,rubrics:1744429439,submissions:2104732668,gradeScale:980501320,grades:2130903440,gradesDetails:644559151,settings:1413275461},e.activeSheetPage="tags",e.assessmentView=e.resetAssessmentView(),e.totalScore=0,e.activeStudent=0,e.activeAssignment=0,e.activeSubmission=null,e.scoreLock=!0,e.activeRubric=[],e.activeGrading={},e.database={tags:{categories:[],data:[]},submissions:[],rubrics:[],assignments:[],roster:[],grades:{},gradesDetails:{},gradeScale:[],settings:{}},e.disabled=!1,e.loading=!0,e.t={csvURL:"CSV URL",debugData:"Debug data",points:"Points",criteria:"Criteria",description:"Description",assessmentWeight:"Assessment Weight",overallFeedback:"Overall feedback",letterGrade:"Letter grade",highRange:"High range",lowRange:"Low range",noSubmission:"No submission found",studentSubmission:"Student submission",openInNewWindow:"Open in new window"},e.registerLocalization({context:y(e),basePath:"undefined"==typeof document?new(require("url").URL)("file:"+__filename).href:document.currentScript&&document.currentScript.src||new URL("grade-book.umd.js",document.baseURI).href,locales:["es","fr","de"]}),e.addEventListener("simple-fields-tag-list-changed",e.qualitativeFeedbackUpdate.bind(y(e))),e.addEventListener("value-changed",e.rubricCriteriaPointsChange),e.addEventListener("drop",e._handleDragDrop.bind(y(e))),e}return p(n,[{key:"resetAssessmentView",value:function(){return{qualitative:[],written:[]}}},{key:"getActiveSubmission",value:function(){for(var e in this.database.submissions){var t=this.database.submissions[e];if(console.log(t),t.student===this.database.roster[this.activeStudent].student&&t[this.database.assignments[this.activeAssignment].shortName])return t[this.database.assignments[this.activeAssignment].shortName]}return null}},{key:"getActiveRubric",value:function(){var e=this;return this.database.rubrics.filter(function(t){return t.shortName==e.database.assignments[e.activeAssignment].rubric})}},{key:"updated",value:function(e){var t=this;k(b(n.prototype),"updated",this)&&k(b(n.prototype),"updated",this).call(this,e),e.forEach(function(e,n){"debug"==n&&t[n],["activeAssignment","activeStudent","database","loading"].includes(n)&&(t.activeSubmission=t.getActiveSubmission(),t.assessmentView=t.resetAssessmentView(),t.activeRubric=t.getActiveRubric(),t.shadowRoot&&t.shadowRoot.querySelector(".mini-map div[data-active-assignment-student-pixel]")&&setTimeout(function(){t.shadowRoot.querySelector(".mini-map").scrollTop=t.shadowRoot.querySelector(".mini-map div[data-active-assignment-student-pixel]").offsetTop-120-t.shadowRoot.querySelector(".mini-map").offsetTop},100)),"source"==n&&t[n]&&(clearTimeout(t.__debouce),t.__debouce=setTimeout(c(regeneratorRuntime.mark(function e(){var r;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:t.loading=!0,e.t0=regeneratorRuntime.keys(t.sheetGids);case 2:if((e.t1=e.t0()).done){e.next=11;break}return r=e.t1.value,t.activeSheetPage=r,e.next=7,t.loadCSVData("".concat(t[n],"&gid=").concat(t.sheetGids[t.activeSheetPage]),t.activeSheetPage);case 7:t.database[t.activeSheetPage]=e.sent,t.requestUpdate(),e.next=2;break;case 11:t.loading=!1,setTimeout(function(){if(t.database.gradeScale.length>0){var e=t.shadowRoot.querySelectorAll("letter-grade");for(var n in Array.from(e))e[n].gradeScale=t.database.gradeScale}},0);case 13:case"end":return e.stop()}},e)})),100)),"sheet"==n&&t[n]&&(t.source="https://docs.google.com/spreadsheets/d/e/".concat(t[n],"/pub?output=csv"))})}},{key:"loadCSVData",value:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r=this;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,fetch(t,{method:this.method}).then(function(e){if(e.ok)return e.text()}).then(function(e){return r.handleResponse(e,n)});case 2:return e.abrupt("return",e.sent);case 3:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"handleResponse",value:function(){var e=c(regeneratorRuntime.mark(function e(t,n){var r,i,a,s,l,c,u;return regeneratorRuntime.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:for(l in r=o.CSVtoArray(t),i=r.shift(),a={},s=[],i)a[i[l]]=l;for(l in r){for(u in c={},a)c[u]=r[l][a[u]];s.push(c)}return e.abrupt("return","function"==typeof this["process".concat(n,"Data")]?this["process".concat(n,"Data")](r,a,s):s);case 7:case"end":return e.stop()}},e,this)}));return function(t,n){return e.apply(this,arguments)}}()},{key:"processassignmentsData",value:function(e,t,n){for(var r in n){var i=new Date("".concat(n[r].dueDate," ").concat(n[r].dueTime));n[r]._ISODueDate=i.toISOString()}return n}},{key:"processtagsData",value:function(e,t,n){var r=new Set([]),i=[];for(var a in n)n[a].category=n[a].category?n[a].category.split(","):[],n[a].associatedMaterial=n[a].associatedMaterial?n[a].associatedMaterial.split(","):[],n[a].category.forEach(function(e){r.add(e)}),i=S(Array.from(r));return{categories:i,data:n}}},{key:"processrubricsData",value:function(e,t,n){for(var r in n)n[r].qualitative=n[r].qualitative?n[r].qualitative.split(","):[];return n}},{key:"processrosterData",value:function(e,t,n){for(var r in n)n[r].interests=n[r].interests?n[r].interests.split(","):[];return n}},{key:"processsettingsData",value:function(e,t,n){var r={};for(var i in n)r[n[i].key]=n[i].value;return r}},{key:"changeStudent",value:function(e){"prev"==e.target.value?this.activeStudent--:"next"==e.target.value&&this.activeStudent++}},{key:"changeAssignment",value:function(e){"prev"==e.target.value?this.activeAssignment--:"next"==e.target.value&&this.activeAssignment++,this.requestUpdate()}},{key:"renderSubmission",value:function(e){var t=i.html(ke(),this.t.studentSubmission);return o.validURL(e)?(t=i.html(we(),t,e,this.t.openInNewWindow),e!=o.cleanVideoSource(e)?i.html(ye(),t,e):i.html(ve(),t,e)):i.html(be(),t,e)}},{key:"render",value:function(){var e=this;return i.html(me(),this.changeStudent,0===this.activeStudent,this.changeStudent,this.database.roster.length-1===this.activeStudent,this.changeAssignment,0===this.activeAssignment,this.changeAssignment,this.database.assignments.length-1===this.activeAssignment,this.loading,this.database.roster[this.activeStudent]?i.html(ge(),this.database.roster[this.activeStudent]):i.html(fe()),this.database.roster.length&&this.database.assignments.length?i.html(he(),this.database.roster.map(function(t,n){return i.html(pe(),e.database.assignments.map(function(t,r){return i.html(de(),e.activeStudent===n&&e.activeAssignment===r)}))})):i.html(ue()),this.database.assignments.length&&this.database.assignments[this.activeAssignment]?i.html(ce(),this.database.assignments[this.activeAssignment].name,this.database.assignments[this.activeAssignment]._ISODueDate,Math.floor(this.database.assignments[this.activeAssignment]._ISODueDate-new Date("2021-03-01T10:20:08"))/6e4,this.activeSubmission?this.renderSubmission(this.activeSubmission):i.html(le(),this.t.noSubmission)):i.html(oe()),this.accentColor,this.t.letterGrade,this.t.highRange,this.t.lowRange,this.database.gradeScale.map(function(e){return i.html(se(),e.letter,e.highRange,e.lowRange)}),this.updateStudentReport,this.activeRubric[0]?i.html(ae(),this.activeRubric[0].name,this.activeRubric.map(function(t){return i.html(ie(),t.criteria,t.description,e.accentColor,t.qualitative.map(function(e){return i.html(re(),e)}),t.percentage,t.qualitative.map(function(e){return i.html(ne(),t.criteria,e)}),"max"===e.database.settings.defaultScore?Math.round(t.percentage/100*e.database.assignments[e.activeAssignment].points):e.database.settings.defaultScore,Math.round(t.percentage/100*e.database.assignments[e.activeAssignment].points),t.criteria,t.criteria,t.criteria)}),this.scoreLock?"lock":"lock-open",this.toggleLock,this.scoreLock,this.totalScoreChangedEvent,this.database.assignments[this.activeAssignment].points,this.database.assignments[this.activeAssignment].points,this.totalScore):i.html(te()),this.loading?i.html(Y()):i.html(ee(),this.database.rubrics.filter(function(t){return t.shortName==e.database.assignments[e.activeAssignment].rubric}).map(function(t){return i.html(Z(),t.criteria,e.getCriteriaScore(t.criteria),Math.round(t.percentage/100*e.database.assignments[e.activeAssignment].points),t.description,t.qualitative.map(function(n){return i.html(X(),n,e.activeGrading[t.criteria]?i.html(K(),e.activeGrading[t.criteria][n].map(function(e){return i.html($(),e.term,e.description?i.html(Q(),e.description):"",e.associatedMaterial?i.html(J(),e.associatedMaterial.map(function(e){return i.html(H(),e,e)})):"")})):"")}),e.getCriteriaFeedback(t.criteria))}),this.t.overallFeedback,this.getCriteriaFeedback("overall"),this.totalScore,this.database.assignments[this.activeAssignment].points,this.database.assignments[this.activeAssignment].points,this.totalScore),this.database.tags.categories.length>0?i.html(W(),this.debug?i.html(F(),this.t.debugData,this.disabled,this.source,this.sourceUpdate,this.t.csvURL,this.source):"",this.database.tags.categories.map(function(t,n){return i.html(B(),e.pickColor(n),t,e.database.tags.data.filter(function(e){return e.category.includes(t)}).map(function(t){return i.html(V(),e.keyDown,e.setDragTransfer,e.pickColor(n),t.term,t)}))})):i.html(M()))}},{key:"rubricCriteriaPointsChange",value:function(e){var t=this;null!=e.detail.getAttribute("data-rubric-score")&&(clearTimeout(this.__debouce),this.__debouce=setTimeout(function(){t.loading||(t.updateTotalScore(),t.shadowRoot.querySelector("#totalpts").value=t.totalScore),t.scoreLock=!0},10))}},{key:"updateTotalScore",value:function(){var e=0,t=this.shadowRoot.querySelectorAll("#assessmentview editable-table-display");for(var n in Array.from(t))t[n].shadowRoot.querySelector("[data-rubric-score]").value&&(e+=parseInt(t[n].shadowRoot.querySelector("simple-fields-field").value));this.totalScore=e,this.requestUpdate()}},{key:"totalScoreChangedEvent",value:function(e){this.totalScore=e.detail.value,this.requestUpdate()}},{key:"toggleLock",value:function(e){this.scoreLock=!this.scoreLock}},{key:"updateStudentReport",value:function(){this.requestUpdate()}},{key:"getCriteriaScore",value:function(e){var t=this.shadowRoot.querySelectorAll("#assessmentview editable-table-display");for(var n in Array.from(t))if(t[n].shadowRoot.querySelector('[data-rubric-score][data-criteria="'.concat(e,'"]')))return t[n].shadowRoot.querySelector('[data-rubric-score][data-criteria="'.concat(e,'"]')).value;return 0}},{key:"getCriteriaFeedback",value:function(e){return this.shadowRoot.querySelector('#assessmentview [data-rubric-written][data-criteria="'.concat(e,'"]'))?this.shadowRoot.querySelector('#assessmentview [data-rubric-written][data-criteria="'.concat(e,'"]')).value:""}},{key:"qualitativeFeedbackUpdate",value:function(e){this.activeGrading[e.detail.getAttribute("data-criteria")]||(this.activeGrading[e.detail.getAttribute("data-criteria")]={}),this.activeGrading[e.detail.getAttribute("data-criteria")][e.detail.label]=e.detail.tagList,this.requestUpdate()}},{key:"keyDown",value:function(e){e.key}},{key:"pickColor",value:function(e){for(var t=Object.keys(this.colors);e>t.length;)e-=t.length;return t[e]}},{key:"_handleDragDrop",value:function(e){window.dispatchEvent(new CustomEvent("simple-tag-drop",{detail:{value:"drop"}}))}},{key:"setDragTransfer",value:function(e){window.dispatchEvent(new CustomEvent("simple-tag-dragstart",{detail:{value:e.target}}));var t=e.target.data;t.color=e.target.accentColor,e.dataTransfer.setData("text",JSON.stringify(t))}},{key:"sourceUpdate",value:function(e){this.source=e.detail.value}}],[{key:"properties",get:function(){return g(g({},k(b(n),"properties",this)),{},{disabled:{type:Boolean,reflect:!0},loading:{type:Boolean,reflect:!0},activeStudent:{type:Number,attribute:"active-student"},activeAssignment:{type:Number,attribute:"active-assignment"},totalScore:{type:Number},scoreLock:{type:Boolean},debug:{type:Boolean},sheet:{type:String},source:{type:String},activeSubmission:{type:String,attribute:!1},database:{type:Object,attribute:!1},activeRubric:{type:Object,attribute:!1},assessmentView:{type:Object,attribute:!1},activeGrading:{type:Object,attribute:!1}})}},{key:"styles",get:function(){return[].concat(S(k(b(n),"styles",this)),[i.css(G())])}},{key:"tag",get:function(){return"grade-book"}}]),n}();customElements.define(xe.tag,xe),e.GradeBook=xe,Object.defineProperty(e,"__esModule",{value:!0})});
